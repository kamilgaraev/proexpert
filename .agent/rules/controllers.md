---
trigger: always_on
---

Архитектура (Architecture)

1. Контроллеры (Controllers)
- Оставляй контроллеры "тонкими".
- Не помещай бизнес-логику в контроллеры. Переноси ее в **Сервисы**.
- Используй Dependency Injection (внедрение зависимостей) в конструкторах.

5. Обработка ошибок и логирование (Error Handling & Logging)
- Каждый публичный метод контроллера должен содержать блок `try-catch`.
- В блоке `catch` обязательно логировать ошибку через `Log::error` с подробным контекстом (параметры запроса, ID пользователя, ID сессии).
- Всегда возвращай структурированный ответ об ошибке через классы `AdminResponse`, `MobileResponse` или `LandingResponse`.
- Не допускай "голых" исключений, которые приводят к стандартной странице 500 ошибки Laravel.

2. Сервисы (Services)
- Расположены в `app/Services`.
- Должны содержать бизнес-логику.
- Должны возвращать DTO или Модели, а не HTTP ответы.

3. DTO (Data Transfer Objects)
- Расположены в `app/DTOs` или `app/DataTransferObjects`.
- Используй DTO для передачи сложных данных между слоями.

4. Модели (Models)
- Расположены в `app/Models`.
- Оставляй модели чистыми. Используй Scopes (заготовки запросов) и Traits (трейты) для переиспользуемой логики запросов.
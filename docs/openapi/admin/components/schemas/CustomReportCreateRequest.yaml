type: object
description: Запрос на создание кастомного отчета
required:
  - name
  - report_category
  - data_sources
  - columns_config
properties:
  name:
    type: string
    maxLength: 255
    description: Название отчета (обязательное)
    example: "Финансы по проектам"
  description:
    type: string
    maxLength: 1000
    nullable: true
    description: Описание отчета (опционально)
    example: "Суммы контрактов по каждому проекту"
  report_category:
    type: string
    enum: ["core", "finances", "materials", "works", "staff"]
    description: Категория отчета (обязательное)
    example: "finances"
  data_sources:
    type: object
    description: Конфигурация источников данных (обязательное)
    required:
      - primary
    properties:
      primary:
        type: string
        description: Основной источник данных (обязательное)
        example: "projects"
      joins:
        type: array
        nullable: true
        description: JOIN'ы с другими таблицами (опционально)
        items:
          type: object
          required:
            - table
            - type
            - on
          properties:
            table:
              type: string
              example: "contracts"
            type:
              type: string
              enum: ["left", "inner", "right"]
              example: "left"
            on:
              type: array
              items:
                type: string
              minItems: 2
              maxItems: 2
              example: ["projects.id", "contracts.project_id"]
  query_config:
    type: object
    nullable: true
    description: Конфигурация WHERE условий (опционально)
    properties:
      where:
        type: array
        items:
          type: object
          properties:
            field:
              type: string
              example: "projects.status"
            operator:
              type: string
              example: "="
            value:
              oneOf:
                - type: string
                - type: number
                - type: boolean
                - type: array
                - type: object
              example: "active"
      where_logic:
        type: string
        enum: ["and", "or"]
        default: "and"
        example: "and"
  columns_config:
    type: array
    minItems: 1
    description: Конфигурация колонок отчета (обязательное, минимум 1)
    items:
      type: object
      required:
        - field
        - label
        - order
      properties:
        field:
          type: string
          description: Имя поля (table.field)
          example: "projects.name"
        label:
          type: string
          description: Название колонки для отображения
          example: "Название проекта"
        order:
          type: integer
          minimum: 1
          description: Порядковый номер колонки
          example: 1
        format:
          type: string
          nullable: true
          enum: ["text", "number", "currency", "percent", "date", "datetime", "boolean"]
          description: Формат отображения значения
          example: "text"
        aggregation:
          type: string
          nullable: true
          enum: ["sum", "avg", "count", "min", "max", "count_distinct"]
          description: Агрегатная функция для поля
          example: "sum"
  filters_config:
    type: array
    nullable: true
    description: Конфигурация пользовательских фильтров (опционально)
    items:
      type: object
      properties:
        field:
          type: string
          example: "projects.status"
        label:
          type: string
          example: "Статус проекта"
        type:
          type: string
          enum: ["select", "text", "number", "date", "date_range", "boolean"]
          example: "select"
        options:
          type: array
          nullable: true
          items:
            type: string
          example: ["active", "completed", "on_hold"]
        required:
          type: boolean
          example: false
        default:
          nullable: true
          example: null
  aggregations_config:
    type: object
    nullable: true
    description: Конфигурация агрегаций (опционально)
    properties:
      group_by:
        type: array
        items:
          type: string
        example: ["projects.id", "projects.name"]
      aggregations:
        type: array
        items:
          type: object
          properties:
            field:
              type: string
              example: "contracts.total_amount"
            function:
              type: string
              enum: ["sum", "avg", "count", "min", "max", "count_distinct"]
              example: "sum"
            alias:
              type: string
              example: "total_amount"
      having:
        type: array
        nullable: true
        items:
          type: object
          properties:
            field:
              type: string
            operator:
              type: string
            value:
              oneOf:
                - type: string
                - type: number
  sorting_config:
    type: array
    nullable: true
    description: Конфигурация сортировки (опционально)
    items:
      type: object
      properties:
        field:
          type: string
          example: "created_at"
        direction:
          type: string
          enum: ["asc", "desc"]
          example: "desc"
  visualization_config:
    type: object
    nullable: true
    description: Конфигурация визуализации (опционально)
    properties:
      enabled:
        type: boolean
        example: true
      chart_type:
        type: string
        enum: ["bar", "line", "pie", "area"]
        example: "bar"
      x_axis:
        type: string
        example: "projects.name"
      y_axis:
        type: string
        example: "total_amount"
      colors:
        type: array
        items:
          type: string
        example: ["#3b82f6", "#10b981"]
  is_shared:
    type: boolean
    nullable: true
    default: false
    description: Сделать ли отчет общим для организации
    example: false

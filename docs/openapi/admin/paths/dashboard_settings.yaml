/dashboard/widgets:
  get:
    tags: [DashboardSettings]
    summary: Получить доступные виджеты дашборда
    description: |
      Возвращает реестр всех доступных виджетов дашборда с учетом ролей пользователя.
      Виджеты фильтруются по ролям пользователя в указанной организации.
    parameters:
      - in: query
        name: org_id
        schema:
          type: integer
        description: ID организации (если не указан, используется текущая организация)
        example: 10
    responses:
      "200":
        description: Список доступных виджетов
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object
                  properties:
                    version:
                      type: integer
                      description: Версия реестра виджетов
                      example: 1
                    widgets:
                      type: array
                      items:
                        $ref: '../components/schemas/DashboardWidget.yaml'
            example:
              success: true
              data:
                version: 1
                widgets:
                  - id: "contracts_statistics"
                    title: "Статистика контрактов"
                    description: "Общая статистика по контрактам организации"
                    component: "ContractsStatisticsWidget"
                    default_enabled: true
                    default_size:
                      xs: 12
                      md: 6
                      lg: 4
                    roles: ["admin", "manager"]

/dashboard/settings:
  get:
    tags: [DashboardSettings]
    summary: Получить настройки дашборда пользователя
    description: |
      Возвращает персональные настройки дашборда для текущего пользователя
      в указанной организации. Настройки автоматически синхронизируются с реестром виджетов.
    parameters:
      - in: query
        name: org_id
        schema:
          type: integer
        description: ID организации
        example: 10
    responses:
      "200":
        description: Настройки дашборда пользователя
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '../components/schemas/DashboardSettings.yaml'
            example:
              success: true
              data:
                version: 1
                layout_mode: "simple"
                items:
                  - id: "contracts_statistics"
                    enabled: true
                    order: 10
                    size:
                      xs: 12
                      md: 6
                      lg: 4
                updated_at: "2024-12-20T15:30:00Z"
      "204":
        description: Настройки не найдены (пользователь использует настройки по умолчанию)
  put:
    tags: [DashboardSettings]
    summary: Сохранить настройки дашборда
    description: |
      Сохраняет персональные настройки дашборда пользователя.
      Настройки валидируются против текущего реестра виджетов.
    parameters:
      - in: query
        name: org_id
        schema:
          type: integer
        description: ID организации
        example: 10
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/DashboardSettingsSaveRequest.yaml'
          examples:
            simple_layout:
              summary: "Простой макет с базовыми виджетами"
              value:
                version: 1
                layout_mode: "simple"
                items:
                  - id: "contracts_statistics"
                    enabled: true
                    order: 10
                    size:
                      xs: 12
                      md: 6
                      lg: 4
                  - id: "recent_activity"
                    enabled: true
                    order: 20
                    size:
                      xs: 12
                      md: 6
                      lg: 8
            grid_layout:
              summary: "Grid макет с позиционированием"
              value:
                version: 1
                layout_mode: "grid"
                items:
                  - id: "contracts_statistics"
                    enabled: true
                    order: 10
                    size:
                      xs: 12
                      md: 6
                      lg: 4
                    layout:
                      x: 0
                      y: 0
                      w: 4
                      h: 3
    responses:
      "200":
        description: Настройки успешно сохранены
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '../components/schemas/DashboardSettings.yaml'
            example:
              success: true
              data:
                version: 1
                layout_mode: "simple"
                items:
                  - id: "contracts_statistics"
                    enabled: true
                    order: 10
      "409":
        description: Конфликт версий (версия в запросе не соответствует текущей)
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                error:
                  type: string
                  example: "invalid_version"
      "422":
        description: Ошибка валидации настроек
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                error:
                  type: string
                  example: "unknown_widget_id"
            examples:
              unknown_widget:
                summary: "Неизвестный виджет"
                value:
                  success: false
                  error: "unknown_widget_id"
              duplicate_order:
                summary: "Дублирующийся порядок"
                value:
                  success: false
                  error: "duplicate_order"
              size_too_small:
                summary: "Размер меньше минимального"
                value:
                  success: false
                  error: "size_too_small"
      "500":
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                error:
                  type: string
                  example: "internal_error"
  delete:
    tags: [DashboardSettings]
    summary: Сбросить настройки дашборда к умолчанию
    description: |
      Удаляет персональные настройки дашборда пользователя,
      возвращая к настройкам по умолчанию из реестра виджетов.
    parameters:
      - in: query
        name: org_id
        schema:
          type: integer
        description: ID организации
        example: 10
    responses:
      "200":
        description: Настройки успешно сброшены
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: "reset"

/dashboard/settings/defaults:
  get:
    tags: [DashboardSettings]
    summary: Получить настройки дашборда по умолчанию
    description: |
      Возвращает настройки дашборда по умолчанию, построенные на основе
      реестра виджетов с учетом ролей пользователя в организации.
    parameters:
      - in: query
        name: org_id
        schema:
          type: integer
        description: ID организации
        example: 10
    responses:
      "200":
        description: Настройки по умолчанию
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '../components/schemas/DashboardSettings.yaml'
            example:
              success: true
              data:
                version: 1
                layout_mode: "simple"
                items:
                  - id: "contracts_statistics"
                    enabled: true
                    order: 10
                    size:
                      xs: 12
                      md: 6
                      lg: 4
                updated_at: "2024-12-20T15:30:00Z"
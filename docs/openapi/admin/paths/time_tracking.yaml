/time-tracking:
  get:
    tags: [Time Tracking]
    summary: Получить список записей времени
    description: |
      Возвращает пагинированный список записей времени для текущей организации.
      Поддерживает фильтрацию по пользователю, проекту, статусу и дате.
      
      **Возможные статусы записей:**
      - `draft` - черновик
      - `submitted` - отправлено на утверждение
      - `approved` - утверждено
      - `rejected` - отклонено
    parameters:
      - name: user_id
        in: query
        required: false
        schema:
          type: integer
        description: Фильтр по пользователю
        example: 15
      - name: project_id
        in: query
        required: false
        schema:
          type: integer
        description: Фильтр по проекту
        example: 8
      - name: status
        in: query
        required: false
        schema:
          type: string
          enum: ["draft", "submitted", "approved", "rejected"]
        description: Фильтр по статусу
        example: "approved"
      - name: start_date
        in: query
        required: false
        schema:
          type: string
          format: date
        description: Дата начала периода (включительно)
        example: "2024-01-01"
      - name: end_date
        in: query
        required: false
        schema:
          type: string
          format: date
        description: Дата окончания периода (включительно)
        example: "2024-01-31"
      - name: billable
        in: query
        required: false
        schema:
          type: boolean
        description: Фильтр по оплачиваемости времени
        example: true
      - name: per_page
        in: query
        required: false
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 15
        description: Количество записей на страницу
        example: 20
    responses:
      "200":
        description: Список записей времени
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: array
                  items:
                    $ref: '../components/schemas/TimeEntry.yaml'
                meta:
                  type: object
                  properties:
                    current_page:
                      type: integer
                      example: 1
                    last_page:
                      type: integer
                      example: 5
                    per_page:
                      type: integer
                      example: 15
                    total:
                      type: integer
                      example: 67
      "401":
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'
      "500":
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Ошибка при получении записей времени"

  post:
    tags: [Time Tracking]
    summary: Создать новую запись времени
    description: |
      Создает новую запись времени. По умолчанию запись создается в статусе `draft`.
      
      **Обязательные поля:**
      - `organization_id` - ID организации
      - `user_id` - ID пользователя
      - `project_id` - ID проекта
      - `work_date` - дата работы
      - `start_time` - время начала
      - `title` - название/описание работы
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/TimeEntryCreateRequest.yaml'
    responses:
      "201":
        description: Запись времени успешно создана
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: "Запись времени успешно создана"
                data:
                  $ref: '../components/schemas/TimeEntry.yaml'
      "400":
        description: Ошибка валидации данных
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Validation error"
                errors:
                  type: object
                  additionalProperties:
                    type: array
                    items:
                      type: string
      "401":
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'
      "403":
        description: Недостаточно прав для создания записей времени
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'

/time-tracking/{id}:
  get:
    tags: [Time Tracking]
    summary: Получить конкретную запись времени
    description: Возвращает детальную информацию о записи времени включая связанные данные
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Идентификатор записи времени
        example: 123
    responses:
      "200":
        description: Данные записи времени
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  $ref: '../components/schemas/TimeEntry.yaml'
      "404":
        description: Запись времени не найдена
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Запись времени не найдена"
      "401":
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'

  put:
    tags: [Time Tracking]
    summary: Обновить запись времени
    description: |
      Обновляет существующую запись времени.
      Можно обновлять только записи в статусе `draft` или `rejected`.
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Идентификатор записи времени
        example: 123
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/TimeEntryUpdateRequest.yaml'
    responses:
      "200":
        description: Запись времени успешно обновлена
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: "Запись времени успешно обновлена"
                data:
                  $ref: '../components/schemas/TimeEntry.yaml'
      "400":
        description: Ошибка валидации данных
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                errors:
                  type: object
                  additionalProperties:
                    type: array
                    items:
                      type: string
      "404":
        description: Запись времени не найдена или не может быть изменена
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Запись времени не найдена или не может быть изменена"
      "401":
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'
      "403":
        description: Недостаточно прав для редактирования записей времени
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'

  delete:
    tags: [Time Tracking]
    summary: Удалить запись времени
    description: |
      Удаляет запись времени. 
      Можно удалять только записи в статусе `draft` или `rejected`.
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Идентификатор записи времени
        example: 123
    responses:
      "200":
        description: Запись времени успешно удалена
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: "Запись времени успешно удалена"
      "404":
        description: Запись времени не найдена или не может быть удалена
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Запись времени не найдена или не может быть удалена"
      "401":
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'
      "500":
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Ошибка при удалении записи времени"

/time-tracking/{id}/approve:
  post:
    tags: [Time Tracking]
    summary: Утвердить запись времени
    description: |
      Утверждает запись времени. Запись должна быть в статусе `submitted`.
      После утверждения статус изменяется на `approved`.
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Идентификатор записи времени
        example: 123
    requestBody:
      required: false
      content:
        application/json:
          schema:
            type: object
            properties:
              reason:
                type: string
                maxLength: 500
                description: Дополнительный комментарий к утверждению
                example: "Работа выполнена качественно"
    responses:
      "200":
        description: Запись времени успешно утверждена
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: "Запись времени успешно утверждена"
      "404":
        description: Запись времени не найдена или не может быть утверждена
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Запись времени не найдена или не может быть утверждена"
      "401":
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'
      "403":
        description: Недостаточно прав для утверждения записей времени
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'
      "500":
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Ошибка при утверждении записи времени"

/time-tracking/{id}/reject:
  post:
    tags: [Time Tracking]
    summary: Отклонить запись времени
    description: |
      Отклоняет запись времени. Запись должна быть в статусе `submitted`.
      После отклонения статус изменяется на `rejected`.
      Обязательно указание причины отклонения.
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Идентификатор записи времени
        example: 123
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [reason]
            properties:
              reason:
                type: string
                maxLength: 500
                description: Причина отклонения (обязательно)
                example: "Неточное описание выполненной работы"
    responses:
      "200":
        description: Запись времени отклонена
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: "Запись времени отклонена"
      "400":
        description: Ошибка валидации (не указана причина)
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Validation error"
                errors:
                  type: object
                  properties:
                    reason:
                      type: array
                      items:
                        type: string
                        example: "Причина отклонения обязательна для заполнения"
      "404":
        description: Запись времени не найдена или не может быть отклонена
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Запись времени не найдена или не может быть отклонена"
      "401":
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'
      "403":
        description: Недостаточно прав для отклонения записей времени
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'
      "500":
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Ошибка при отклонении записи времени"

/time-tracking/{id}/submit:
  post:
    tags: [Time Tracking]
    summary: Отправить запись на утверждение
    description: |
      Отправляет запись времени на утверждение. Запись должна быть в статусе `draft`.
      После отправки статус изменяется на `submitted`.
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Идентификатор записи времени
        example: 123
    responses:
      "200":
        description: Запись времени отправлена на утверждение
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: "Запись времени отправлена на утверждение"
      "404":
        description: Запись времени не найдена или не может быть отправлена на утверждение
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Запись времени не найдена или не может быть отправлена на утверждение"
      "401":
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'
      "500":
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Ошибка при отправке записи времени на утверждение"

/time-tracking/statistics/overview:
  get:
    tags: [Time Tracking]
    summary: Получить статистику по времени
    description: |
      Возвращает агрегированную статистику по записям времени для текущей организации.
      Включает общее время, количество записей, распределение по статусам и проектам.
    parameters:
      - name: user_id
        in: query
        required: false
        schema:
          type: integer
        description: Фильтр по пользователю
        example: 15
      - name: project_id
        in: query
        required: false
        schema:
          type: integer
        description: Фильтр по проекту
        example: 8
      - name: start_date
        in: query
        required: false
        schema:
          type: string
          format: date
        description: Дата начала периода
        example: "2024-01-01"
      - name: end_date
        in: query
        required: false
        schema:
          type: string
          format: date
        description: Дата окончания периода
        example: "2024-01-31"
    responses:
      "200":
        description: Статистика по времени
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object
                  properties:
                    total_hours:
                      type: number
                      format: float
                      description: Общее количество часов
                      example: 168.5
                    billable_hours:
                      type: number
                      format: float
                      description: Оплачиваемые часы
                      example: 152.0
                    total_entries:
                      type: integer
                      description: Общее количество записей
                      example: 45
                    status_breakdown:
                      type: object
                      properties:
                        draft:
                          type: integer
                          example: 5
                        submitted:
                          type: integer
                          example: 8
                        approved:
                          type: integer
                          example: 30
                        rejected:
                          type: integer
                          example: 2
                    project_breakdown:
                      type: array
                      items:
                        type: object
                        properties:
                          project_id:
                            type: integer
                            example: 8
                          project_name:
                            type: string
                            example: "Проект Alpha"
                          hours:
                            type: number
                            format: float
                            example: 85.5
                          entries_count:
                            type: integer
                            example: 23
                    user_breakdown:
                      type: array
                      items:
                        type: object
                        properties:
                          user_id:
                            type: integer
                            example: 15
                          user_name:
                            type: string
                            example: "Иванов Иван"
                          hours:
                            type: number
                            format: float
                            example: 42.5
                          entries_count:
                            type: integer
                            example: 12
      "401":
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'
      "500":
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Ошибка при получении статистики"

/time-tracking/calendar/entries:
  get:
    tags: [Time Tracking]
    summary: Получить записи времени для календаря
    description: |
      Возвращает записи времени, сгруппированные по дням для отображения в календаре.
      По умолчанию возвращает данные за текущий месяц.
    parameters:
      - name: user_id
        in: query
        required: false
        schema:
          type: integer
        description: Фильтр по пользователю
        example: 15
      - name: project_id
        in: query
        required: false
        schema:
          type: integer
        description: Фильтр по проекту
        example: 8
      - name: start_date
        in: query
        required: false
        schema:
          type: string
          format: date
        description: Дата начала периода (по умолчанию - начало текущего месяца)
        example: "2024-01-01"
      - name: end_date
        in: query
        required: false
        schema:
          type: string
          format: date
        description: Дата окончания периода (по умолчанию - конец текущего месяца)
        example: "2024-01-31"
    responses:
      "200":
        description: Данные календаря с записями времени
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object
                  additionalProperties:
                    type: object
                    properties:
                      date:
                        type: string
                        format: date
                        example: "2024-01-15"
                      total_hours:
                        type: number
                        format: float
                        example: 8.5
                      entries_count:
                        type: integer
                        example: 3
                      entries:
                        type: array
                        items:
                          $ref: '../components/schemas/TimeEntry.yaml'
      "401":
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'
      "500":
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Ошибка при получении данных календаря"

/time-tracking/reports/generate:
  get:
    tags: [Time Tracking]
    summary: Сгенерировать отчет по времени
    description: |
      Генерирует детальный отчет по записям времени с возможностью группировки.
      По умолчанию группирует данные по пользователям за текущий месяц.
    parameters:
      - name: user_id
        in: query
        required: false
        schema:
          type: integer
        description: Фильтр по пользователю
        example: 15
      - name: project_id
        in: query
        required: false
        schema:
          type: integer
        description: Фильтр по проекту
        example: 8
      - name: start_date
        in: query
        required: false
        schema:
          type: string
          format: date
        description: Дата начала периода (по умолчанию - начало текущего месяца)
        example: "2024-01-01"
      - name: end_date
        in: query
        required: false
        schema:
          type: string
          format: date
        description: Дата окончания периода (по умолчанию - конец текущего месяца)
        example: "2024-01-31"
      - name: group_by
        in: query
        required: false
        schema:
          type: string
          enum: ["user", "project", "work_type", "date"]
          default: "user"
        description: Способ группировки данных в отчете
        example: "project"
    responses:
      "200":
        description: Отчет по времени
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
                data:
                  type: object
                  properties:
                    summary:
                      type: object
                      properties:
                        total_hours:
                          type: number
                          format: float
                          example: 168.5
                        billable_hours:
                          type: number
                          format: float
                          example: 152.0
                        total_cost:
                          type: number
                          format: float
                          example: 45600.0
                        entries_count:
                          type: integer
                          example: 45
                    groups:
                      type: array
                      items:
                        type: object
                        properties:
                          group_key:
                            type: string
                            description: Ключ группировки (зависит от group_by)
                            example: "Иванов Иван"
                          group_id:
                            type: integer
                            description: ID группы (зависит от group_by)
                            example: 15
                          hours:
                            type: number
                            format: float
                            example: 42.5
                          billable_hours:
                            type: number
                            format: float
                            example: 40.0
                          total_cost:
                            type: number
                            format: float
                            example: 12000.0
                          entries_count:
                            type: integer
                            example: 12
                          entries:
                            type: array
                            items:
                              $ref: '../components/schemas/TimeEntry.yaml'
      "401":
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ErrorResponse.yaml'
      "500":
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: false
                message:
                  type: string
                  example: "Ошибка при генерации отчета"

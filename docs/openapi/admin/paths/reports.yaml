/reports/material-usage:
  get:
    tags: [Reports]
    summary: Отчет по расходу материалов
    parameters:
      - in: query
        name: project_id
        schema:
          type: integer
      - in: query
        name: material_id
        schema:
          type: integer
      - in: query
        name: user_id
        schema:
          type: integer
      - in: query
        name: date_from
        schema:
          type: string
          format: date
      - in: query
        name: date_to
        schema:
          type: string
          format: date
    responses:
      "200":
        description: Данные отчета
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ReportResponse.yaml'

/reports/work-completion:
  get:
    tags: [Reports]
    summary: Отчет по выполненным работам
    parameters:
      - in: query
        name: project_id
        schema:
          type: integer
      - in: query
        name: work_type_id
        schema:
          type: integer
      - in: query
        name: user_id
        schema:
          type: integer
      - in: query
        name: date_from
        schema:
          type: string
          format: date
      - in: query
        name: date_to
        schema:
          type: string
          format: date
    responses:
      "200":
        description: Данные отчета
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ReportResponse.yaml'

/reports/foreman-activity:
  get:
    tags: [Reports]
    summary: Отчет по активности прорабов
    parameters:
      - in: query
        name: project_id
        schema:
          type: integer
      - in: query
        name: user_id
        schema:
          type: integer
      - in: query
        name: date_from
        schema:
          type: string
          format: date
      - in: query
        name: date_to
        schema:
          type: string
          format: date
    responses:
      "200":
        description: Данные отчета
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ReportResponse.yaml'

/reports/project-status-summary:
  get:
    tags: [Reports]
    summary: Сводный отчет по статусам проектов
    parameters:
      - in: query
        name: status
        schema:
          type: string
          enum: [active, completed, planned, on_hold]
      - in: query
        name: is_archived
        schema:
          type: boolean
    responses:
      "200":
        description: Данные отчета
        content:
          application/json:
            schema:
              $ref: '../components/schemas/ReportResponse.yaml'

/reports/official-material-usage:
  get:
    tags: [Reports]
    summary: Официальный отчет об использовании материалов, переданных Заказчиком
    security:
      - bearerAuth: []
    parameters:
      - in: query
        name: project_id
        schema:
          type: integer
        required: true
      - in: query
        name: date_from
        schema:
          type: string
          format: date
        required: true
      - in: query
        name: date_to
        schema:
          type: string
          format: date
        required: true
      - in: query
        name: report_number
        schema:
          type: integer
      - in: query
        name: material_id
        schema:
          type: integer
      - in: query
        name: material_name
        schema:
          type: string
      - in: query
        name: operation_type
        schema:
          type: string
          enum: [receipt, write_off]
      - in: query
        name: supplier_id
        schema:
          type: integer
      - in: query
        name: document_number
        schema:
          type: string
      - in: query
        name: work_type_id
        schema:
          type: integer
      - in: query
        name: work_description
        schema:
          type: string
      - in: query
        name: user_id
        schema:
          type: integer
      - in: query
        name: foreman_id
        schema:
          type: integer
      - in: query
        name: invoice_date_from
        schema:
          type: string
          format: date
      - in: query
        name: invoice_date_to
        schema:
          type: string
          format: date
      - in: query
        name: min_quantity
        schema:
          type: number
          format: float
      - in: query
        name: max_quantity
        schema:
          type: number
          format: float
      - in: query
        name: min_price
        schema:
          type: number
          format: float
      - in: query
        name: max_price
        schema:
          type: number
          format: float
      - in: query
        name: has_photo
        schema:
          type: boolean
      - in: query
        name: format
        schema:
          type: string
          enum: [json, xlsx, csv]
        description: "Укажите xlsx, чтобы получить ссылку на скачивание Excel-файла."
    x-codeSamples:
      - lang: CURL
        label: Excel download
        source: |
          curl -H "Authorization: Bearer <TOKEN>" \
               "https://api.prohelper.pro/api/v1/admin/reports/official-material-usage?project_id=1&date_from=2024-01-01&date_to=2024-01-31&format=xlsx" | jq
    responses:
      "200":
        description: Данные отчета либо ссылка на файл
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '../components/schemas/ReportResponse.yaml'
                - type: object
                  properties:
                    download_url:
                      type: string
                      format: uri
                    expires_at:
                      type: string
                      format: date-time
            examples:
              ExcelLink:
                summary: Ссылка на скачивание Excel
                value:
                  download_url: "https://official-reports.website.regru.cloud/official-material-usage/2025/07/official_material_report_1_20250709.xlsx?X-Amz-Signature=abc123..."
                  expires_at: "2025-07-09T14:42:00+03:00"
              JsonData:
                summary: Агрегированные данные (формат=json)
                value:
                  title: "Официальный отчет об использовании материалов"
                  filters:
                    project_id: 1
                    date_from: "2024-01-01"
                    date_to: "2024-01-31"
                  data:
                    materials_count: 12
                    total_economy: -54.2
                  generated_at: "2025-07-09T12:40:12+03:00" 
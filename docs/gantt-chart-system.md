# 📊 Система графика работ с диаграммой Ганта

## 🎯 Обзор системы

Система графика работ с диаграммой Ганта - это полнофункциональная система управления проектами, предназначенная для планирования, отслеживания и контроля строительных проектов. Система реализует профессиональные алгоритмы управления проектами, включая метод критического пути (CPM), управление ресурсами и анализ отклонений.

## 🏗️ Архитектура системы

### Основные компоненты

```
┌─────────────────────────────────────────────────────────────┐
│                    FRONTEND (React)                         │
├─────────────────────────────────────────────────────────────┤
│                    API LAYER (Laravel)                      │
├─────────────────────────────────────────────────────────────┤
│  Controllers  │  Services  │  Repositories  │  Models       │
├─────────────────────────────────────────────────────────────┤
│                    DATABASE (MySQL)                         │
└─────────────────────────────────────────────────────────────┘
```

### Модели данных

1. **ProjectSchedule** - основная модель графика проекта
2. **ScheduleTask** - задачи в графике с иерархической структурой
3. **TaskDependency** - зависимости между задачами (4 типа связей)
4. **TaskResource** - ресурсы, назначенные на задачи
5. **TaskMilestone** - контрольные точки и вехи проекта

## 📋 Функциональные возможности

### 🎪 Планирование проектов

#### Создание и управление графиками
- **Создание графиков** из шаблонов или с нуля
- **Иерархическая структура задач** (WBS - Work Breakdown Structure)
- **Автоматическая генерация WBS кодов** для задач
- **Шаблоны графиков** для повторного использования
- **Базовые планы** для анализа отклонений

#### Типы задач
- **Обычные задачи** - с длительностью и ресурсами
- **Вехи** - контрольные точки без длительности
- **Суммарные задачи** - группирующие подзадачи
- **Контейнеры** - организационные группы

### 🔗 Управление зависимостями

#### Типы связей между задачами
1. **FS (Finish-to-Start)** - стандартная последовательность
2. **SS (Start-to-Start)** - параллельный старт
3. **FF (Finish-to-Finish)** - синхронное завершение
4. **SF (Start-to-Finish)** - обратная зависимость

#### Дополнительные возможности
- **Лаги и опережения** с поддержкой дней, часов и процентов
- **Жесткие и мягкие ограничения** дат
- **Автоматическая валидация** на циклические зависимости
- **Приоритизация связей** для разрешения конфликтов

### 🧠 Алгоритм критического пути (CPM)

#### Расчетные алгоритмы
- **Forward Pass** - расчет ранних дат начала и окончания
- **Backward Pass** - расчет поздних дат начала и окончания
- **Float Calculation** - общие и свободные резервы времени
- **Critical Path Identification** - определение критического пути

#### Результаты расчета
- Длительность проекта
- Задачи на критическом пути
- Резервы времени для каждой задачи
- Statistics по проекту

### 👥 Управление ресурсами

#### Типы ресурсов
- **Люди** - сотрудники с навыками и загрузкой
- **Материалы** - строительные материалы с остатками
- **Оборудование** - техника с календарем доступности
- **Внешние ресурсы** - подрядчики и услуги

#### Функции управления ресурсами
- **Процентная загрузка** ресурсов (25%, 50%, 100%, 150%)
- **Автоматическая детекция конфликтов** перегрузки
- **Календари работы** для каждого ресурса
- **Стоимостной учет** по часам и единицам
- **Стратегии разрешения конфликтов**

### 📈 Отслеживание прогресса

#### Виды прогресса
- **Процентное выполнение** задач
- **Фактические даты** начала и окончания
- **Трудозатраты** плановые и фактические
- **Стоимостной прогресс** и отклонения

#### Автоматические расчеты
- **Каскадное обновление** прогресса родительских задач
- **Пересчет общего прогресса** графика
- **Автоматическое изменение статусов** задач
- **Уведомления о просрочках**

### 🎯 Вехи и контрольные точки

#### Типы вех
- **Начало/окончание проекта** - ключевые даты
- **Начало/окончание фазы** - этапы проекта
- **Поставки** - результаты работ
- **Согласования** - approval points
- **Платежи** - финансовые вехи
- **Пользовательские** - специфичные для проекта

#### Функциональность вех
- **Критерии достижения** с автоматической проверкой
- **Уведомления** заинтересованных сторон
- **Связь с платежами** и финансовыми операциями
- **Управление рисками** и планы снижения

## 🔧 API Документация

### Основные эндпоинты

#### Графики проектов
```http
GET    /api/v1/schedules              - Список графиков с фильтрацией
POST   /api/v1/schedules              - Создание нового графика
GET    /api/v1/schedules/{id}         - Детали графика
PUT    /api/v1/schedules/{id}         - Обновление графика
DELETE /api/v1/schedules/{id}         - Удаление графика
```

#### Специальные операции
```http
POST   /api/v1/schedules/{id}/critical-path  - Расчет критического пути
POST   /api/v1/schedules/{id}/baseline       - Сохранение базового плана
DELETE /api/v1/schedules/{id}/baseline       - Очистка базового плана
```

#### Дополнительные эндпоинты
```http
GET    /api/v1/schedules/templates       - Шаблоны графиков
POST   /api/v1/schedules/from-template   - Создание из шаблона
GET    /api/v1/schedules/statistics      - Статистика по графикам
GET    /api/v1/schedules/overdue         - Графики с просрочками
GET    /api/v1/schedules/recent          - Недавно обновленные
```

### Структура данных

#### ProjectSchedule
```json
{
  "id": 123,
  "project_id": 456,
  "name": "График строительства дома",
  "planned_start_date": "2025-02-01",
  "planned_end_date": "2025-12-31",
  "status": "active",
  "overall_progress_percent": 35.5,
  "critical_path_calculated": true,
  "critical_path_duration_days": 280,
  "total_estimated_cost": 15000000.00,
  "ui_data": {
    "can_edit": true,
    "progress_color": "#3B82F6",
    "status_color": "#3B82F6"
  }
}
```

#### ScheduleTask
```json
{
  "id": 789,
  "name": "Заливка фундамента",
  "planned_start_date": "2025-02-15",
  "planned_end_date": "2025-02-28",
  "planned_duration_days": 14,
  "progress_percent": 75.0,
  "is_critical": true,
  "status": "in_progress",
  "assigned_user": {
    "id": 101,
    "name": "Иван Петров"
  }
}
```

### Параметры фильтрации

#### Для списка графиков
- `status` - фильтр по статусу
- `project_id` - графики конкретного проекта
- `is_template` - только шаблоны
- `search` - поиск по названию и описанию
- `date_from`, `date_to` - диапазон дат
- `sort_by`, `sort_order` - сортировка

## 🛠️ Установка и настройка

### 1. Миграции базы данных
```bash
php artisan migrate
```

### 2. Регистрация сервисов
Сервисы автоматически регистрируются через:
- `App\Providers\RepositoryServiceProvider`
- `App\Providers\AppServiceProvider`

### 3. Настройка маршрутов
Маршруты подключены в `App\Providers\RouteServiceProvider`

### 4. Команды для обслуживания
```bash
# Синхронизация остатков материалов
php artisan materials:sync-balances --force

# Расчет критического пути для всех активных графиков
php artisan schedule:calculate-critical-paths

# Архивирование старых графиков
php artisan schedule:archive-completed --days=90
```

## 📊 Алгоритмы и расчеты

### Метод критического пути (CPM)

#### 1. Forward Pass (прямой проход)
```php
// Псевдокод алгоритма
foreach ($tasks as $task) {
    $earlyStart = max($predecessors->earlyFinish + lag);
    $earlyFinish = $earlyStart + $duration;
}
```

#### 2. Backward Pass (обратный проход)
```php
// Псевдокод алгоритма  
foreach ($tasks as $task) {
    $lateFinish = min($successors->lateStart - lag);
    $lateStart = $lateFinish - $duration;
}
```

#### 3. Расчет резервов
```php
$totalFloat = $lateStart - $earlyStart;
$freeFloat = min($successors->earlyStart) - $earlyFinish;
$isCritical = $totalFloat <= 0;
```

### Управление ресурсами

#### Детекция конфликтов
```php
$conflicts = [];
$totalAllocation = $resource->getAllocationsForPeriod($start, $end);
if ($totalAllocation > 100%) {
    $conflicts[] = new ResourceConflict($resource, $period);
}
```

#### Стратегии разрешения конфликтов
1. **Adjustment** - снижение процента загрузки
2. **Rescheduling** - перенос задач
3. **Resource substitution** - замена ресурса
4. **Task splitting** - разделение задач

## 🎨 UI/UX рекомендации

### Диаграмма Ганта
- **Временная шкала** с возможностью масштабирования (дни, недели, месяцы)
- **Цветовое кодирование** задач по статусу и критичности
- **Drag & Drop** для изменения дат и зависимостей
- **Всплывающие подсказки** с деталями задач
- **Фильтрация и группировка** задач

### Панели управления
- **Timeline view** - основной вид диаграммы Ганта
- **Task list view** - табличный вид задач
- **Resource view** - загрузка ресурсов
- **Critical path view** - выделение критического пути
- **Reports view** - отчеты и аналитика

### Интерактивность
- **Real-time updates** при изменениях
- **Collaborative editing** для команды
- **Mobile responsive** для планшетов
- **Keyboard shortcuts** для быстрой работы

## 🔍 Мониторинг и аналитика

### Ключевые метрики
- **SPI (Schedule Performance Index)** - индекс выполнения по срокам
- **CPI (Cost Performance Index)** - индекс выполнения по стоимости
- **Earned Value** - освоенный объем
- **Resource utilization** - загрузка ресурсов

### Отчеты
- **Progress reports** - отчеты о прогрессе
- **Variance analysis** - анализ отклонений
- **Resource reports** - отчеты по ресурсам
- **Risk reports** - отчеты о рисках

### Уведомления
- **Task deadline alerts** - уведомления о дедлайнах
- **Resource conflict warnings** - предупреждения о конфликтах
- **Milestone notifications** - уведомления о вехах
- **Progress updates** - обновления прогресса

## 🚀 Расширения и интеграции

### Возможные интеграции
- **1С:Предприятие** - синхронизация финансовых данных
- **СБИС** - обмен документами
- **Email notifications** - уведомления по почте
- **Mobile apps** - мобильные приложения для прорабов
- **IoT sensors** - датчики на стройплощадке

### Планы развития
- **AI-powered scheduling** - автоматическое планирование
- **Machine learning** для прогнозирования рисков
- **Advanced analytics** - углубленная аналитика
- **3D visualization** - 3D визуализация проектов
- **VR/AR support** - поддержка виртуальной реальности

## 🔧 Техническая информация

### Требования к системе
- **PHP 8.2+** с Laravel 11
- **MySQL 8.0+** или PostgreSQL 13+
- **Redis** для кеширования и очередей
- **Node.js 18+** для фронтенда

### Производительность
- **Индексированные запросы** для быстрого поиска
- **Lazy loading** связанных данных
- **Кеширование** критического пути
- **Пагинация** больших списков
- **Background jobs** для тяжелых операций

### Безопасность
- **Role-based access control** - контроль доступа по ролям
- **Organization isolation** - изоляция данных организаций
- **API authentication** - аутентификация API
- **Data validation** - валидация входных данных
- **SQL injection protection** - защита от SQL инъекций

## 📝 Примеры использования

### Создание простого графика
```php
$schedule = ProjectSchedule::create([
    'project_id' => 1,
    'name' => 'Строительство дома',
    'planned_start_date' => '2025-02-01',
    'planned_end_date' => '2025-12-31',
    'status' => 'draft'
]);

// Добавление задач
$foundation = $schedule->tasks()->create([
    'name' => 'Фундамент',
    'planned_duration_days' => 30,
    'task_type' => 'task'
]);

$walls = $schedule->tasks()->create([
    'name' => 'Стены',
    'planned_duration_days' => 45,
    'task_type' => 'task'
]);

// Создание зависимости
TaskDependency::create([
    'predecessor_task_id' => $foundation->id,
    'successor_task_id' => $walls->id,
    'dependency_type' => 'FS',
    'schedule_id' => $schedule->id
]);
```

### Расчет критического пути
```php
$criticalPathService = app(CriticalPathService::class);
$result = $criticalPathService->calculateCriticalPath($schedule);

echo "Длительность проекта: {$result['duration']} дней";
echo "Критических задач: " . count($result['critical_path']);
```

### Назначение ресурсов
```php
$resource = TaskResource::create([
    'task_id' => $foundation->id,
    'resource_type' => 'user',
    'user_id' => 1,
    'allocation_percent' => 100,
    'assignment_start_date' => $foundation->planned_start_date,
    'assignment_end_date' => $foundation->planned_end_date
]);

// Проверка конфликтов
$conflicts = $resource->checkConflicts();
if (!empty($conflicts)) {
    echo "Обнаружены конфликты ресурсов!";
}
```

## 🎓 Заключение

Система графика работ с диаграммой Ганта представляет собой полнофункциональное решение для управления строительными проектами уровня предприятия. Она включает все необходимые инструменты для профессионального планирования, отслеживания и контроля проектов, используя проверенные алгоритмы и лучшие практики управления проектами.

Система готова к использованию в продакшене и может масштабироваться для крупных организаций с множественными проектами и ресурсами. 
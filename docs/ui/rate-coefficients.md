# –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã (Rate Coefficients)

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤: –∫–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏ (–≤ —Ç–æ–º —á–∏—Å–ª–µ —Ç–∏–ø–∞ `material_norms`) –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å, –∞ —Ç–∞–∫–∂–µ –ø—Ä–∏–º–µ—Ä—ã —Ç–µ–ª API-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤.

---

## 1. UI-—Ä–∞–∑–¥–µ–ª—ã

### 1.1. –°–ø–∏—Å–æ–∫ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤

* **URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã:** `/admin/rate-coefficients`
* –¢–∞–±–ª–∏—Ü–∞:
  | –ö–æ–ª–æ–Ω–∫–∞ | –ü–æ–ª–µ –æ—Ç–≤–µ—Ç–∞ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
  |---------|-------------|------------|
  | ID | `id` |  |
  | –ù–∞–∑–≤–∞–Ω–∏–µ | `name` |  |
  | –ö–æ–¥ | `code` |  |
  | –ó–Ω–∞—á–µ–Ω–∏–µ | `value` | –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 4 –∑–Ω–∞–∫–∞. |
  | –¢–∏–ø | `type` | `percentage` / `fixed_addition` |
  | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | `applies_to` | `material_norms`, `work_costs`, `labor_hours`, `general` |
  | –û–±–ª–∞—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è | `scope` | `global_org`, `project`, `work_type_category`, `work_type`, `material_category`, `material` |
  | –í–∞–ª–∏–¥–µ–Ω —Å | `valid_from` |  |
  | –í–∞–ª–∏–¥–µ–Ω –ø–æ | `valid_to` |  |
  | –ê–∫—Ç–∏–≤–µ–Ω | `is_active` | —á–µ–∫-–±–æ–∫—Å |
  | –î–µ–π—Å—Ç–≤–∏—è | ‚Äî | –ö–Ω–æ–ø–∫–∏ ¬´‚úèÔ∏è¬ª ¬´üóë¬ª |

* **–§–∏–ª—å—Ç—Ä—ã** (query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –ø–∞–Ω–µ–ª–∏ –Ω–∞–¥ —Ç–∞–±–ª–∏—Ü–µ–π):
  * `name`, `code` ‚Äî input.
  * `type`, `applies_to`, `scope` ‚Äî select.
  * `is_active` ‚Äî —á–µ–∫-–±–æ–∫—Å ¬´–¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ¬ª.
  * `valid_from` / `valid_to` ‚Äî –¥–≤–∞ date-picker‚Äô–∞ (—Å / –ø–æ).
  * –ö–Ω–æ–ø–∫–∞ ¬´–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã¬ª —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

### 1.2. –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è / —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑. | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|------|-----|-------|------------|
| –ù–∞–∑–≤–∞–Ω–∏–µ | text | ‚úî | `name` |
| –ö–æ–¥ | text | ‚Äî | `code` |
| –ó–Ω–∞—á–µ–Ω–∏–µ | number (step 0.0001) | ‚úî | `value` |
| –¢–∏–ø | select | ‚úî | enum `percentage` / `fixed_addition` |
| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | select | ‚úî | enum `material_norms`, ‚Ä¶ |
| –û–±–ª–∞—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è | select | ‚úî | enum `global_org`, ‚Ä¶ |
| –î–æ–ø. —É—Å–ª–æ–≤–∏—è (`conditions`) | UI –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `scope` | ‚Äî | JSON —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º |
| –í–∞–ª–∏–¥–µ–Ω —Å | date | ‚Äî | `valid_from` |
| –í–∞–ª–∏–¥–µ–Ω –ø–æ | date | ‚Äî | `valid_to` (‚â• `valid_from`) |
| –ê–∫—Ç–∏–≤–µ–Ω | switch | ‚Äî | `is_active` |
| –û–ø–∏—Å–∞–Ω–∏–µ | textarea | ‚Äî | `description` |

> ‚ö†Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –¥–æ–ª–∂–Ω–∞ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ backend-–∫–ª–∞—Å—Å–æ–≤ `StoreRateCoefficientRequest` / `UpdateRateCoefficientRequest`.

### 1.3. –î–æ–ø. —É—Å–ª–æ–≤–∏—è (UI-–ø–æ–¥—Å–∫–∞–∑–∫–∏)

| `scope` | –ö–ª—é—á JSON | –ß—Ç–æ —Ä–∏—Å—É–µ–º |
|---------|-----------|-----------|
| `project` | `project_ids: number[]` | multiselect –ø—Ä–æ–µ–∫—Ç–æ–≤ |
| `material` | `material_ids: number[]` | multiselect –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ |
| `material_category` | `material_category_ids: number[]` | multiselect –∫–∞—Ç–µ–≥–æ—Ä–∏–π |

---

## 2. API-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

> –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>`

### 2.1. –°–ø–∏—Å–æ–∫ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤

```
GET /api/v1/admin/rate-coefficients?page=1&per_page=15&name=–±–µ—Ç–æ–Ω
```

–û—Ç–≤–µ—Ç `200 OK`
```json
{
  "data": [
    {
      "id": 7,
      "name": "–ü–æ–≤—ã—à–µ–Ω–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ –±–µ—Ç–æ–Ω–∞",
      "code": "BETON_15",
      "value": 15.0,
      "type": "percentage",
      "applies_to": "material_norms",
      "scope": "material_category",
      "description": "–î–ª—è —Ç—è–∂—ë–ª—ã—Ö –±–µ—Ç–æ–Ω–æ–≤",
      "is_active": true,
      "valid_from": "2024-01-01",
      "valid_to": null,
      "conditions": {"material_category_ids": [3]},
      "created_at": "2024-05-10 09:15:23",
      "updated_at": "2024-05-10 09:15:23"
    }
  ],
  "links": {
    "first": "‚Ä¶?page=1",
    "last": "‚Ä¶?page=5",
    "prev": null,
    "next": "‚Ä¶?page=2"
  },
  "meta": {
    "current_page": 1,
    "from": 1,
    "last_page": 5,
    "path": "‚Ä¶/rate-coefficients",
    "per_page": 15,
    "to": 15,
    "total": 72
  }
}
```

### 2.2. –ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
```
GET /api/v1/admin/rate-coefficients/{id}
```
`200 OK` ‚Äî —Ç–µ–ª–æ –∫–∞–∫ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç –≤—ã—à–µ. 
`404 Not Found` ‚Äî –µ—Å–ª–∏ id –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

### 2.3. –°–æ–∑–¥–∞—Ç—å
```
POST /api/v1/admin/rate-coefficients
Content-Type: application/json
```
Body
```json
{
  "name": "10 % –Ω–∞ –Ω–æ—Ä–º—É –∞—Ä–º–∞—Ç—É—Ä—ã",
  "code": "ARMATURA_10",
  "value": 10,
  "type": "percentage",
  "applies_to": "material_norms",
  "scope": "material",
  "conditions": {"material_ids": [42]},
  "description": "–°–ª–æ–∂–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è",
  "is_active": true,
  "valid_from": "2024-06-01"
}
```
–û—Ç–≤–µ—Ç `201 Created` ‚Äî –æ–±—ä–µ–∫—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞. 
–û—à–∏–±–∫–∏ `422 Unprocessable Entity` —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ–ª–µ `errors`.

### 2.4. –û–±–Ω–æ–≤–∏—Ç—å
```
PUT /api/v1/admin/rate-coefficients/{id}
```
Body (—á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ):
```json
{
  "value": 12.5,
  "description": "–£—Ç–æ—á–Ω–µ–Ω–æ –ö–î",
  "valid_to": "2024-12-31"
}
```
–û—Ç–≤–µ—Ç `200 OK` ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç.

### 2.5. –£–¥–∞–ª–∏—Ç—å
```
DELETE /api/v1/admin/rate-coefficients/{id}
```
–û—Ç–≤–µ—Ç `204 No Content`.

---

## 3. –§–æ—Ä–º–∞—Ç enum-–∑–Ω–∞—á–µ–Ω–∏–π

| –ü–æ–ª–µ | –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è |
|------|--------------------|
| `type` | `percentage`, `fixed_addition` |
| `applies_to` | `material_norms`, `work_costs`, `labor_hours`, `general` |
| `scope` | `global_org`, `project`, `work_type_category`, `work_type`, `material_category`, `material` |

---

## 4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –æ—Ç—á—ë—Ç–∞—Ö

–°–µ—Ä–≤–µ—Ä —É–∂–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã, –ø–æ—ç—Ç–æ–º—É:
* –ø–æ–ª–µ `production_norm` –≤ –æ—Ç–≤–µ—Ç–∞—Ö –æ—Ç—á—ë—Ç–∞ –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º **—É–∂–µ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ**; —Ñ—Ä–æ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫ –µ—Å—Ç—å;
* –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ UI –∫–æ–ª–æ–Ω–∫—É ¬´–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã¬ª ‚Äî –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ API.

---

## 5. –ß–µ–∫-–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- [ ] –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –º–µ–Ω—é –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞—Ö ¬´–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã¬ª.
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É + —Ñ–∏–ª—å—Ç—Ä—ã + –ø–∞–≥–∏–Ω–∞—Ü–∏—é.
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—É Create/Edit, –≤–∫–ª—é—á–∞—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è `conditions`.
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ API —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞–∑–¥–µ–ª—É 2.
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç—á—ë—Ç ¬´–ú–∞—Ç–µ—Ä–∏–∞–ª—ã¬ª ‚Äî –Ω–æ—Ä–º—É –≤—ã–≤–æ–¥–∏—Ç—å –∏–∑ –æ—Ç–≤–µ—Ç–∞ –±–µ–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤. 
 # Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¸ Ñ„Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ²

## Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸

### 1. Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ

#### 1.1 ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ² ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ°
- âœ… ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ±Ğ¾Ñ‚
- âœ… Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°ÑÑ‰Ğ¸Ñ… Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ° (Ñ Ğ´Ğ¾Ğ¿ÑƒÑĞºĞ¾Ğ¼ 1%)
- âœ… Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ñ€Ğ°Ğ±Ğ¾Ñ‚

#### 1.2 ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ñ€Ğ°ÑÑ‡ĞµÑ‚ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ĞµĞ¹
- âœ… ĞĞ±Ñ‰Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ±Ğ¾Ñ‚ Ğ¿Ğ¾ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñƒ
- âœ… ĞÑÑ‚Ğ°Ğ²ÑˆĞ°ÑÑÑ ÑÑƒĞ¼Ğ¼Ğ° Ğ¿Ğ¾ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñƒ
- âœ… ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ°
- âœ… Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ²ÑĞµÑ… Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶ĞµĞ¹ Ğ¸ Ğ°ĞºÑ‚Ğ¾Ğ²

#### 1.3 Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚
- âœ… Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ½Ñ‹Ğµ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹ (ÑÑ‚Ğ°Ñ‚ÑƒÑ: `completed`)
- âœ… Ğ Ğ°ÑÑ‚Ğ¾Ñ€Ğ³Ğ½ÑƒÑ‚Ñ‹Ğµ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹ (ÑÑ‚Ğ°Ñ‚ÑƒÑ: `terminated`)

### 2. ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ²

#### 2.1 Workflow ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ²
- âœ… `draft` â†’ `active` Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ½Ğ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ
- âœ… `active` â†’ `completed` Ğ¿Ñ€Ğ¸ 100% Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸
- âœ… ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹

#### 2.2 Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
- âœ… Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¸Ğ±Ğ»Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğº Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñƒ (90%+)
- âœ… ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ² API Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°Ñ…
- ğŸ”„ Email ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ (Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ° Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°)

## ĞĞ¾Ğ²Ñ‹Ğµ API endpoints

### ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ¿Ğ¾ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñƒ
```http
GET /api/v1/admin/contracts/{contract}/analytics
```

**ĞÑ‚Ğ²ĞµÑ‚:**
```json
{
  "success": true,
  "data": {
    "contract_id": 1,
    "contract_number": "Ğ”ĞĞ“-123/2025",
    "total_amount": 1000000.00,
    "completed_works_amount": 750000.00,
    "remaining_amount": 250000.00,
    "completion_percentage": 75.00,
    "total_paid_amount": 500000.00,
    "total_performed_amount": 700000.00,
    "status": "active",
    "is_nearing_limit": false,
    "can_add_work": true,
    "completed_works_count": 25,
    "confirmed_works_count": 20
  }
}
```

### Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ¿Ğ¾ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñƒ
```http
GET /api/v1/admin/contracts/{contract}/completed-works?per_page=15
```

## ĞœĞ¾Ğ´ĞµĞ»ÑŒ Contract - Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹

### Accessor'Ñ‹ (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹ ĞºĞ°Ğº ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°)
```php
$contract->completed_works_amount  // Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ±Ğ¾Ñ‚
$contract->remaining_amount        // ĞÑÑ‚Ğ°Ğ²ÑˆĞ°ÑÑÑ ÑÑƒĞ¼Ğ¼Ğ°
$contract->completion_percentage   // ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
$contract->total_paid_amount       // Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶ĞµĞ¹
$contract->total_performed_amount  // Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ°ĞºÑ‚Ğ¾Ğ²
```

### ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸
```php
$contract->canAddWork($amount)     // ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ
$contract->isNearingLimit()        // ĞŸÑ€Ğ¸Ğ±Ğ»Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğº Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñƒ (90%+)
$contract->updateStatusBasedOnCompletion() // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ
```

## ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº

### ContractException
```php
ContractException::contractCompleted()       // ĞšĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½
ContractException::contractTerminated()      // ĞšĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚ Ñ€Ğ°ÑÑ‚Ğ¾Ñ€Ğ³Ğ½ÑƒÑ‚
ContractException::amountExceedsLimit()      // ĞŸÑ€ĞµĞ²Ñ‹ÑˆĞµĞ½ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
ContractException::contractNearingLimit()   // ĞŸÑ€Ğ¸Ğ±Ğ»Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğº Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñƒ
```

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ² frontend
```javascript
try {
  await createCompletedWork(workData);
} catch (error) {
  if (error.status === 422) {
    // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸
    showError(error.message);
  }
}
```

## Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚:
- ĞŸÑ€Ğ¸Ğ±Ğ»Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ² Ğº Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñƒ
- Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ² ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ²
- ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½Ğ¸Ñ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ²

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ»Ğ¾Ğ³Ğ°:**
```
[warning] ĞšĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚ #Ğ”ĞĞ“-123/2025 Ğ¿Ñ€Ğ¸Ğ±Ğ»Ğ¸Ğ¶Ğ°ĞµÑ‚ÑÑ Ğº Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñƒ: 92.5%
Context: {
  "contract_id": 1,
  "organization_id": 1,
  "completed_amount": 925000.00,
  "total_amount": 1000000.00,
  "completion_percentage": 92.5
}
```

## Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

Ğ”Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ:
```bash
php artisan tinker test_contract_validation.php
```

## Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ (Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğº Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸)

### Email ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ
```php
// Ğ’ notifyContractNearingLimit()
Mail::to($contract->organization->email)
    ->send(new ContractNearingLimitMail($contract));
```

### Push ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ
```php
// Ğ§ĞµÑ€ĞµĞ· broadcasting
broadcast(new ContractLimitWarning($contract));
```

### Dashboard Ğ²Ğ¸Ğ´Ğ¶ĞµÑ‚Ñ‹
- ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ-Ğ±Ğ°Ñ€Ñ‹ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ²
- Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ² Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‰Ğ¸Ñ… Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ
- Ğ¢Ğ¾Ğ¿ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ² Ğ¿Ğ¾ Ğ¾Ğ±ÑŠĞµĞ¼Ñƒ

## ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

### ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ `with()` Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ÑĞ²ÑĞ·ĞµĞ¹
- ĞšÑÑˆĞ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ²
- Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ½Ğ° `contract_id` Ğ¸ `status` Ğ² `completed_works`

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
```php
$contracts = Contract::with(['completedWorks' => function($query) {
    $query->where('status', 'confirmed');
}])->get();
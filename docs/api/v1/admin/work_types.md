# Документация API: Виды Работ (Admin Panel)

**Базовый путь:** `/api/v1/admin`

**Аутентификация:** Требуется JWT токен (`Bearer <token>`) в заголовке `Authorization`. Токен должен быть для `api_admin`.

**Авторизация:** Все эндпоинты требуют прав доступа к админ-панели (`can:access-admin-panel`). Предполагается наличие прав `can:manage-catalogs` или аналогичных для управления справочниками.

**Контекст организации:** Все запросы выполняются в контексте текущей организации пользователя (`Auth::user()->current_organization_id`), который определяется автоматически middleware.

---

## 1. Виды Работ (`/work-types`)

Эти эндпоинты управляются контроллером `App\Http\Controllers\Api\V1\Admin\WorkTypeController`.

### 1.1. Получение списка видов работ

*   **Эндпоинт:** `GET /work-types`
*   **Метод контроллера:** `index`
*   **Описание:** Возвращает пагинированный список видов работ для текущей организации с возможностью фильтрации.
*   **Параметры запроса (Query):**
    *   `name` (string, опционально): Фильтр по названию.
    *   `category` (string, опционально): Фильтр по категории.
    *   `is_active` (boolean, опционально): Фильтр по активности (true/false).
    *   `sort_by` (string, опционально): Поле для сортировки (например, `name`, `category`, `created_at`, по умолчанию `name`).
    *   `sort_direction` (string, опционально): Направление сортировки (`asc` или `desc`, по умолчанию `asc`).
    *   `per_page` (integer, опционально): Количество записей на страницу (по умолчанию 15).
    *   `page` (integer, опционально): Номер страницы.
*   **Успешный ответ (200):** (Формат коллекции `WorkTypeResource`)
    ```json
    {
      "data": [ /* Массив объектов WorkTypeResource */ ],
      "links": { /* Ссылки пагинации */ }, 
      "meta": { /* Мета-информация пагинации */ }  
    }
    ```

### 1.2. Создание вида работ

*   **Эндпоинт:** `POST /work-types`
*   **Метод контроллера:** `store`
*   **Описание:** Создает новый вид работ. Валидация выполняется `StoreWorkTypeRequest`.
*   **Тело запроса (JSON):**
    *   `name` (string, обязательно): Название вида работ.
    *   `measurement_unit_id` (integer, обязательно): ID единицы измерения.
    *   `category` (string, опционально): Категория вида работ.
    *   `description` (string, опционально): Описание.
    *   `is_active` (boolean, опционально, по умолчанию true): Флаг активности.
    *   `external_code` (string, опционально): Внешний код для интеграций.
*   **Успешный ответ (201):**
    ```json
    {
      "data": { /* Объект WorkTypeResource созданного вида работ */ }
    }
    ```
*   **Ошибка валидации (422).**
*   **Ошибка сервера (500).**

### 1.3. Получение деталей вида работ

*   **Эндпоинт:** `GET /work-types/{work_type}`
*   **Метод контроллера:** `show`
*   **Описание:** Возвращает детальную информацию по конкретному виду работ.
*   **Параметры пути:**
    *   `{work_type}` (integer, обязательно): ID вида работ.
*   **Успешный ответ (200):**
    ```json
    {
      "data": { /* Объект WorkTypeResource */ }
    }
    ```
*   **Ошибка (404):** Если вид работ не найден.

### 1.4. Обновление вида работ

*   **Эндпоинт:** `PUT /work-types/{work_type}`
*   **Метод контроллера:** `update`
*   **Описание:** Обновляет существующий вид работ. Валидация `UpdateWorkTypeRequest`.
*   **Параметры пути:**
    *   `{work_type}` (integer, обязательно): ID вида работ.
*   **Тело запроса (JSON):** (Аналогично созданию, но все поля опциональны)
    *   `name` (string, опционально)
    *   `measurement_unit_id` (integer, опционально)
    *   `category` (string, опционально)
    *   `description` (string, опционально)
    *   `is_active` (boolean, опционально)
    *   `external_code` (string, опционально)
*   **Успешный ответ (200):**
    ```json
    {
      "data": { /* Объект WorkTypeResource обновленного вида работ */ }
    }
    ```
*   **Ошибка валидации (422).**
*   **Ошибка (404):** Если вид работ не найден.
*   **Ошибка сервера (500).**

### 1.5. Удаление вида работ

*   **Эндпоинт:** `DELETE /work-types/{work_type}`
*   **Метод контроллера:** `destroy`
*   **Описание:** Удаляет вид работ. (Предположительно мягкое удаление, если модель использует SoftDeletes).
*   **Параметры пути:**
    *   `{work_type}` (integer, обязательно): ID вида работ.
*   **Успешный ответ (204):** No Content.
*   **Ошибка (404):** Если вид работ не найден.
*   **Ошибка сервера (500):** (например, если вид работ используется и его нельзя удалить).

---

### Формат объекта `WorkTypeResource` (Примерный)

```json
{
  "id": 1,
  "name": "Укладка плитки",
  "category": "Отделочные работы",
  "isActive": true,
  "measurementUnit": {
    "id": 3,
    "name": "м2",
    "code": "sqm"
  },
  "organizationId": 12,
  "createdAt": "2023-02-10T10:00:00",
  "updatedAt": "2023-03-15T11:20:00"
  // "description": "Описание вида работ...", // Если это поле есть в модели и ресурсе
  // "external_code": "EXT-WT-001" // Если это поле есть в модели и ресурсе
}
```

*Примечание: Точный набор полей в `WorkTypeResource` зависит от его реализации (`app/Http/Resources/Api/V1/Admin/WorkTypeResource.php`). Единица измерения (`measurementUnit`) загружается как связанный ресурс.* 
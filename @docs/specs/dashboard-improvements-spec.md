# Спецификация: Масштабирование функционала админского дашборда

## Цель
Масштабировать функционал административного дашборда для предоставления более глубокой аналитики, улучшения UX и повышения продуктивности администраторов системы ProHelper.

## Пользовательские истории

### Для администратора организации
- Как администратор, я хочу видеть финансовую аналитику в реальном времени, чтобы принимать быстрые бизнес-решения
- Как администратор, я хочу настраивать собственные дашборды под разные задачи, чтобы эффективно контролировать разные аспекты бизнеса
- Как администратор, я хочу получать предиктивную аналитику, чтобы предвидеть проблемы до их возникновения
- Как администратор, я хочу сравнивать метрики между проектами, чтобы выявлять лучшие практики
- Как администратор, я хочу видеть KPI сотрудников, чтобы оценивать их эффективность

### Для финансового директора
- Как финдиректор, я хочу видеть cash flow и прогноз доходов, чтобы планировать бюджет
- Как финдиректор, я хочу анализировать рентабельность по проектам, чтобы оптимизировать затраты
- Как финдиректор, я хочу отслеживать дебиторскую и кредиторскую задолженность

### Для технического директора
- Как техдиректор, я хочу видеть загрузку ресурсов, чтобы оптимально распределять задачи
- Как техдиректор, я хочу отслеживать качество выполненных работ
- Как техдиректор, я хочу видеть узкие места в процессах

## Требования

### Функциональные требования

#### 1. Продвинутая аналитика
- **FR-1.1**: Финансовый дашборд с метриками:
  - Cash flow (приток/отток денежных средств)
  - P&L (прибыль и убытки) по проектам
  - Рентабельность (ROI, маржинальность)
  - Прогноз доходов на основе текущих контрактов
  - Дебиторская/кредиторская задолженность

- **FR-1.2**: Операционный дашборд:
  - Загрузка ресурсов (люди, техника, материалы)
  - Производительность по проектам
  - SLA метрики (время выполнения заявок)
  - Качество работ (процент переделок, жалобы)

- **FR-1.3**: HR-аналитика:
  - KPI сотрудников (прорабы, рабочие)
  - Эффективность по выполненным работам
  - Загрузка персонала
  - Рейтинг исполнителей

#### 2. Предиктивная аналитика
- **FR-2.1**: Прогнозирование завершения контрактов на основе текущего темпа работ
- **FR-2.2**: Предсказание превышения бюджета проекта
- **FR-2.3**: Прогноз потребности в материалах
- **FR-2.4**: Выявление рисков срыва сроков

#### 3. Сравнительная аналитика
- **FR-3.1**: Сравнение проектов по ключевым метрикам
- **FR-3.2**: Бенчмаркинг между контрагентами
- **FR-3.3**: Сравнение периодов (месяц к месяцу, год к году)
- **FR-3.4**: Топ/Аутсайдеры по различным метрикам

#### 4. Детализация и drill-down
- **FR-4.1**: Возможность "провалиться" в детали любого виджета
- **FR-4.2**: Связанные метрики (клик на контракт → детали по нему)
- **FR-4.3**: Фильтрация на уровне дашборда (по проекту, периоду, подрядчику)

#### 5. Расширенные виджеты
- **FR-5.1**: Новые виджеты:
  - Карта тепла активности (heatmap)
  - Воронка продаж/проектов
  - Gantt-chart по проектам
  - Сетевой график зависимостей
  - Календарь событий/дедлайнов
  - Лента уведомлений и алертов

#### 6. Кастомизация дашбордов
- **FR-6.1**: Множественные дашборды на одного пользователя
- **FR-6.2**: Шаринг дашбордов между пользователями
- **FR-6.3**: Шаблоны дашбордов для разных ролей
- **FR-6.4**: Drag-and-drop редактор виджетов
- **FR-6.5**: Сохранение пресетов фильтров

#### 7. Real-time обновления
- **FR-7.1**: WebSocket соединение для live-обновлений критических метрик
- **FR-7.2**: Настраиваемая частота обновления виджетов
- **FR-7.3**: Push-уведомления о важных изменениях

#### 8. Экспорт и отчетность
- **FR-8.1**: Экспорт дашборда в PDF с графиками
- **FR-8.2**: Экспорт данных в Excel
- **FR-8.3**: Планирование автоматической отправки отчетов
- **FR-8.4**: API для получения данных дашборда

#### 9. Продвинутые фильтры
- **FR-9.1**: Глобальные фильтры дашборда (проект, период, статус)
- **FR-9.2**: Сохранение фильтров
- **FR-9.3**: Быстрые пресеты ("Активные проекты", "Просроченные", "Этот месяц")

#### 10. Алерты и уведомления
- **FR-10.1**: Настройка триггеров для алертов (порог превышен, срок истекает)
- **FR-10.2**: Визуальные индикаторы на виджетах (красный/желтый/зеленый)
- **FR-10.3**: История алертов

### Нефункциональные требования

#### Производительность
- **NFR-1**: Загрузка дашборда < 2 секунд
- **NFR-2**: Обновление виджета < 500мс
- **NFR-3**: Поддержка до 50 виджетов на дашборде
- **NFR-4**: Кеширование данных с TTL 5-15 минут
- **NFR-5**: Оптимизация SQL-запросов (использование индексов, агрегаций)

#### Масштабируемость
- **NFR-6**: Поддержка до 100 одновременных пользователей дашборда
- **NFR-7**: Горизонтальное масштабирование через Redis кеш
- **NFR-8**: Queue для тяжелых вычислений (прогнозы, экспорты)

#### UX/UI
- **NFR-9**: Адаптивный дизайн (desktop, tablet)
- **NFR-10**: Темная тема
- **NFR-11**: Анимации и transitions для лучшего UX
- **NFR-12**: Skeleton loaders при загрузке

#### Безопасность
- **NFR-13**: Проверка permissions на уровне виджетов
- **NFR-14**: Аудит просмотров чувствительных данных
- **NFR-15**: Rate limiting для API дашборда

## Критерии приемки

### Базовая функциональность
- [ ] Реализованы все 5 новых виджетов финансовой аналитики
- [ ] Реализованы 3 виджета операционной аналитики
- [ ] Работает drill-down для всех виджетов
- [ ] Множественные дашборды для пользователя
- [ ] Drag-and-drop редактор виджетов

### Аналитика
- [ ] Прогнозирование завершения контрактов работает с точностью 80%+
- [ ] Сравнение проектов по 10+ метрикам
- [ ] Топ/Аутсайдеры по всем основным сущностям

### Производительность
- [ ] Время загрузки дашборда < 2 сек на 20+ виджетах
- [ ] Нагрузочные тесты пройдены для 100 одновременных пользователей
- [ ] 90% запросов отвечают за < 500мс

### UX
- [ ] Адаптивность протестирована на 5+ разрешениях
- [ ] Темная тема полностью реализована
- [ ] Все анимации плавные (60fps)

### Экспорт и API
- [ ] PDF экспорт с графиками работает
- [ ] Excel экспорт всех данных
- [ ] API endpoint для всех виджетов
- [ ] Планировщик отчетов

## Технические ограничения

### Backend
- Laravel 11.x
- PHP 8.2+
- PostgreSQL 15+ (для аналитических запросов)
- Redis для кеширования

### Frontend (предполагается)
- Vue.js 3.x или React 18+
- Chart.js / ECharts / ApexCharts для графиков
- Vuedraggable или react-grid-layout для drag-and-drop

### Инфраструктура
- Octane для ускорения
- Horizon для очередей
- WebSockets (Laravel Broadcasting + Reverb/Pusher)

## Зависимости

### Существующие компоненты
- `DashboardService` - расширить
- `DashboardWidgetsRegistry` - расширить
- `SubscriptionLimitsService` - интеграция
- Модуль `dashboard-widgets` - расширить
- Модуль `material-analytics` - интеграция
- Модуль `advanced-reports` - интеграция

### Новые компоненты (требуется создать)
- `FinancialAnalyticsService` - финансовая аналитика
- `PredictiveAnalyticsService` - прогнозы
- `KPICalculationService` - расчет KPI
- `DashboardCacheService` - умное кеширование
- `AlertsService` - система алертов
- `DashboardExportService` - экспорт дашбордов

### Внешние зависимости
- Библиотека для машинного обучения (прогнозы) - опционально
- Библиотека для PDF с графиками (Puppeteer или Browsershot)

## Приоритеты реализации

### P0 - Критически важно
- Финансовая аналитика (cash flow, P&L, ROI)
- Множественные дашборды
- Drag-and-drop редактор
- Производительность и кеширование

### P1 - Высокий приоритет
- Предиктивная аналитика
- Drill-down и детализация
- Real-time обновления
- Расширенные виджеты

### P2 - Средний приоритет
- Сравнительная аналитика
- HR-аналитика и KPI
- Экспорт в PDF/Excel
- API для дашборда

### P3 - Низкий приоритет
- Темная тема
- Планировщик отчетов
- Шаринг дашбордов
- История алертов

## Метрики успеха

### Пользовательские метрики
- Увеличение времени работы с дашбордом на 50%
- Уменьшение времени поиска нужной информации на 70%
- NPS от администраторов > 8/10

### Бизнес-метрики
- Снижение количества просроченных контрактов на 30%
- Увеличение выявления проблем на ранних стадиях на 50%
- ROI от внедрения достигнут за 3 месяца

### Технические метрики
- Uptime дашборда > 99.5%
- P95 время ответа < 1 секунда
- Количество ошибок < 0.1%


# Phase 1: Services - –ü–†–û–ì–†–ï–°–° 80% ‚è≥

## –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
4 –æ–∫—Ç—è–±—Ä—è 2025

## –û–±–∑–æ—Ä
Phase 1 —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–∏ core —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è Advanced Dashboard –º–æ–¥—É–ª—è. –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, —Å–æ–∑–¥–∞–Ω—ã –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

## –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (5 –∏–∑ 6)

#### 1. FinancialAnalyticsService (~620 —Å—Ç—Ä–æ–∫)
**–§–∞–π–ª:** `app/BusinessModules/Features/AdvancedDashboard/Services/FinancialAnalyticsService.php`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `getCashFlow(org, from, to, project?)` - –¥–≤–∏–∂–µ–Ω–∏–µ –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
  - –ü—Ä–∏—Ç–æ–∫/–æ—Ç—Ç–æ–∫ –ø–æ –º–µ—Å—è—Ü–∞–º
  - –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
  - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ 5 –º–∏–Ω—É—Ç
- `getProfitAndLoss(org, from, to, project?)` - –æ—Ç—á–µ—Ç P&L
  - –í—ã—Ä—É—á–∫–∞, COGS, OpEx
  - –í–∞–ª–æ–≤–∞—è, –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è, —á–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å
  - –ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å (gross, operating, net)
  - P&L –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º
- `getROI(org, project?, from?, to?)` - —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π
  - ROI –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º
  - –¢–æ–ø –∏ —Ö—É–¥—à–∏–µ –ø—Ä–æ–µ–∫—Ç—ã
  - –°—Ä–µ–¥–Ω–∏–π ROI –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- `getRevenueForecast(org, months=6)` - –ø—Ä–æ–≥–Ω–æ–∑ –¥–æ—Ö–æ–¥–æ–≤
  - –ù–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
  - –ù–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–µ–Ω–¥–∞ (–ª–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è)
  - –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ (70% –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã, 30% —Ç—Ä–µ–Ω–¥)
  - –£—Ä–æ–≤–µ–Ω—å –¥–æ–≤–µ—Ä–∏—è
- `getReceivablesPayables(org)` - –¥–µ–±–∏—Ç–æ—Ä–∫–∞/–∫—Ä–µ–¥–∏—Ç–æ—Ä–∫–∞
  - –¢–µ–∫—É—â–∏–µ, –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ (30, 60, 90+ –¥–Ω–µ–π)
  - –ü–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º/–ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º
  - –ß–∏—Å—Ç–∞—è –ø–æ–∑–∏—Ü–∏—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Redis –∫–µ—à (TTL: 300 —Å–µ–∫)
- TODO: –¥–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–∏—Ç–æ–∫–∞/–æ—Ç—Ç–æ–∫–∞
- TODO: –¥–µ–±–∏—Ç–æ—Ä—Å–∫–∞—è/–∫—Ä–µ–¥–∏—Ç–æ—Ä—Å–∫–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å

#### 2. DashboardLayoutService (~490 —Å—Ç—Ä–æ–∫)
**–§–∞–π–ª:** `app/BusinessModules/Features/AdvancedDashboard/Services/DashboardLayoutService.php`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `createDashboard(user, org, data)` - —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ (10 per user)
  - Auto-generation slug
  - –ü–µ—Ä–≤—ã–π –¥–∞—à–±–æ—Ä–¥ = default
- `createFromTemplate(user, org, template, name?)` - –∏–∑ —à–∞–±–ª–æ–Ω–∞
  - admin, finance, technical, hr
  - –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã –∏ layout
- `updateDashboardLayout/Widgets/Filters(id, data)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- `shareDashboard(id, userIds[], visibility)` - —Ä–∞—Å—à–∞—Ä–∏–≤–∞–Ω–∏–µ
  - team, organization visibility
- `duplicateDashboard(id, newName?)` - –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `getUserDashboards(user, org, includeShared)` - —Å–ø–∏—Å–æ–∫ –¥–∞—à–±–æ—Ä–¥–æ–≤
- `getDefaultDashboard(user, org)` - –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –¥–∞—à–±–æ—Ä–¥
- `setDefaultDashboard(id)` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ default
- `deleteDashboard(id)` - —É–¥–∞–ª–µ–Ω–∏–µ —Å –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º default

**–®–∞–±–ª–æ–Ω—ã –¥–∞—à–±–æ—Ä–¥–æ–≤:**
1. **admin** - contracts_overview, projects_status, recent_activity
2. **finance** - cash_flow, profit_loss, roi, revenue_forecast (4 –≤–∏–¥–∂–µ—Ç–∞)
3. **technical** - completed_works, materials_usage, low_stock
4. **hr** - kpi, top_performers, resource_utilization

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –¥–∞—à–±–æ—Ä–¥–æ–≤ (10 –º–∏–Ω—É—Ç)
- Auto-invalidation –∫–µ—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- Default layout: grid 12 columns

#### 3. AlertsService (~500 —Å—Ç—Ä–æ–∫)
**–§–∞–π–ª:** `app/BusinessModules/Features/AdvancedDashboard/Services/AlertsService.php`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `registerAlert(user, org, data)` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–∞
  - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
  - 7 —Ç–∏–ø–æ–≤ –∞–ª–µ—Ä—Ç–æ–≤
  - Cooldown –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 60 –º–∏–Ω—É—Ç
- `checkAllAlerts(org?)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: checked, triggered, errors
- `checkAlertConditions(alert)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–ª–µ—Ä—Ç–∞
- `toggleAlert(id, isActive)` - –≤–∫–ª/–≤—ã–∫–ª –∞–ª–µ—Ä—Ç–∞
- `resetAlert(id)` - —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `getAlertHistory(id, limit=50)` - –∏—Å—Ç–æ—Ä–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π

**–¢–∏–ø—ã –∞–ª–µ—Ä—Ç–æ–≤:**
1. `budget_overrun` - –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞
2. `deadline_risk` - —Ä–∏—Å–∫ —Å—Ä—ã–≤–∞ —Å—Ä–æ–∫–æ–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
3. `low_stock` - –Ω–∏–∑–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
4. `contract_completion` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (%)
5. `payment_overdue` - –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ (TODO)
6. `kpi_threshold` - –ø–æ—Ä–æ–≥ KPI (TODO)
7. `custom` - –∫–∞—Å—Ç–æ–º–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (TODO)

**–û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:**
- `gt`, `>`, `gte`, `>=`, `lt`, `<`, `lte`, `<=`, `eq`, `==`, `neq`, `!=`

**–ö–∞–Ω–∞–ª—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
- `email` - –æ—Ç–ø—Ä–∞–≤–∫–∞ email (TODO: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
- `in_app` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (TODO)
- `webhook` - webhook –≤—ã–∑–æ–≤—ã (TODO)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:**
- `low`, `medium`, `high`, `critical`

**–°–æ–±—ã—Ç–∏—è:**
- `AlertTriggered` - —Å–æ–±—ã—Ç–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –∞–ª–µ—Ä—Ç–∞

#### 4. PredictiveAnalyticsService (~560 —Å—Ç—Ä–æ–∫)
**–§–∞–π–ª:** `app/BusinessModules/Features/AdvancedDashboard/Services/PredictiveAnalyticsService.php`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `predictContractCompletion(contractId)` - –ø—Ä–æ–≥–Ω–æ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
  - –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
  - –õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è (slope, intercept, R¬≤)
  - –ü—Ä–æ–≥–Ω–æ–∑ –¥–∞—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  - –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –ø–ª–∞–Ω–∞ (–≤ –¥–Ω—è—Ö)
  - –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞ –∏ –¥–æ–≤–µ—Ä–∏—è
- `predictBudgetOverrun(projectId)` - —Ä–∏—Å–∫ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –±—é–¥–∂–µ—Ç–∞
  - –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ (weekly)
  - –¢—Ä–µ–Ω–¥ —Ä–∞—Å—Ö–æ–¥–æ–≤
  - –ü—Ä–æ–≥–Ω–æ–∑ –∏—Ç–æ–≥–æ–≤—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
  - % –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –±—é–¥–∂–µ—Ç–∞
  - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- `predictMaterialNeeds(org, months=3)` - –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö
  - –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (6 –º–µ—Å—è—Ü–µ–≤)
  - –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ N –º–µ—Å—è—Ü–µ–≤
  - –î–µ—Ñ–∏—Ü–∏—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
  - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- `getOrganizationForecast(org)` - –æ–±—â–∏–π –ø—Ä–æ–≥–Ω–æ–∑ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
  - –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–∞–º
  - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤
  - High-risk projects

**–ê–ª–≥–æ—Ä–∏—Ç–º –ª–∏–Ω–µ–π–Ω–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏:**
- –§–æ—Ä–º—É–ª–∞: y = mx + b
- –†–∞—Å—á–µ—Ç: slope (m), intercept (b), R-squared
- –û—Ü–µ–Ω–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞

**–£—Ä–æ–≤–Ω–∏ —Ä–∏—Å–∫–∞:**
- `low` - –≤ —Å—Ä–æ–∫ –∏–ª–∏ —Ä–∞–Ω—å—à–µ, < 5% –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è
- `medium` - –∑–∞–¥–µ—Ä–∂–∫–∞ 7-14 –¥–Ω–µ–π, 5-10% –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è
- `high` - –∑–∞–¥–µ—Ä–∂–∫–∞ 14-30 –¥–Ω–µ–π, 10-20% –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è
- `critical` - –∑–∞–¥–µ—Ä–∂–∫–∞ > 30 –¥–Ω–µ–π, > 20% –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è

**–£—Ä–æ–≤–µ–Ω—å –¥–æ–≤–µ—Ä–∏—è:**
- < 3 —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö ‚Üí 0.3 (low confidence)
- 3-10 —Ç–æ—á–µ–∫ ‚Üí 0.6 (medium confidence)
- 10+ —Ç–æ—á–µ–∫ ‚Üí 0.85 (high confidence)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Redis –∫–µ—à (TTL: 300 —Å–µ–∫)
- TODO: –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- TODO: –∏—Å—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

#### 5. KPICalculationService (~540 —Å—Ç—Ä–æ–∫)
**–§–∞–π–ª:** `app/BusinessModules/Features/AdvancedDashboard/Services/KPICalculationService.php`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `calculateUserKPI(user, org, from, to)` - KPI —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
  - 6 –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - –í–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞ (0-100 –±–∞–ª–ª–æ–≤)
  - –£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `getTopPerformers(org, from, to, limit=10)` - —Ç–æ–ø –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏
  - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ overall KPI
  - –°—Ä–µ–¥–Ω–∏–π KPI –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- `getResourceUtilization(org, from, to)` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
  - –û—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ vs —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏
  - % —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
  - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: underutilized, optimal, overutilized
- `getUserKPITrend(user, org, months=6)` - —Ç—Ä–µ–Ω–¥ KPI
  - –ü–æ–º–µ—Å—è—á–Ω—ã–π KPI
  - –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞ (improving/stable/declining)
- `getKPIByDepartment(org, from, to)` - KPI –ø–æ –æ—Ç–¥–µ–ª–∞–º (TODO)

**–ú–µ—Ç—Ä–∏–∫–∏ KPI:**
1. `completed_works_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç (–≤–µ—Å: 20%)
2. `work_volume` - –æ–±—ä–µ–º —Ä–∞–±–æ—Ç (sum quantity)
3. `on_time_completion_rate` - % –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å—Ä–æ–∫ (–≤–µ—Å: 25%) [TODO]
4. `quality_score` - –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (–≤–µ—Å: 25%) [TODO]
5. `revenue_generated` - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Ä—É—á–∫–∞
6. `cost_efficiency` - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞—Ç—Ä–∞—Ç (–≤–µ—Å: 30%)

**–£—Ä–æ–≤–Ω–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- `exceptional` - KPI ‚â• 90
- `high` - KPI ‚â• 75
- `good` - KPI ‚â• 60
- `average` - KPI ‚â• 40
- `low` - KPI < 40

**–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏:**
- `underutilized` - < 50% (–Ω–µ–¥–æ–≥—Ä—É–∂–µ–Ω—ã)
- `optimal` - 50-90% (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)
- `overutilized` - > 90% (–ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω—ã)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Redis –∫–µ—à (TTL: 300 —Å–µ–∫)
- TODO: —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç
- TODO: deadline tracking –¥–ª—è on-time rate
- TODO: —Å–≤—è–∑—å User ‚Üí Organization

### ‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

#### 6. DashboardExportService (–°–õ–ï–î–£–Æ–©–ò–ô)
**–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã:**
- `exportDashboardToPDF(dashboardId, options)`
- `exportDashboardToExcel(dashboardId, options)`
- `generateScheduledReport(reportId)`
- `sendReportByEmail(reportId, recipients[])`

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- PDF: Browsershot (Headless Chrome) –∏–ª–∏ DomPDF
- Excel: Maatwebsite/Excel (PhpSpreadsheet)

### üî≤ –û–∂–∏–¥–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### DashboardCacheService
**–¶–µ–ª—å:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º –¥–∞—à–±–æ—Ä–¥–æ–≤

**–ú–µ—Ç–æ–¥—ã:**
- `cacheWidget(key, data, ttl, tags[])`
- `getCachedWidget(key)`
- `invalidateWidgetCache(widgetType, organizationId?)`
- `invalidateUserCache(userId)`
- `invalidateDashboardCache(dashboardId)`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Tagged cache (Redis)
- TTL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 300 —Å–µ–∫
- –¢–µ–≥–∏: widget_type, organization, user, dashboard

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Phase 1

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | –ú–µ—Ç–æ–¥–æ–≤ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-----------|---------|-------------|
| FinancialAnalyticsService | ‚úÖ | ~620 | 20+ | Cash Flow, P&L, ROI, Forecasts |
| DashboardLayoutService | ‚úÖ | ~490 | 15+ | CRUD –¥–∞—à–±–æ—Ä–¥–æ–≤, —à–∞–±–ª–æ–Ω—ã |
| AlertsService | ‚úÖ | ~500 | 15+ | 7 —Ç–∏–ø–æ–≤ –∞–ª–µ—Ä—Ç–æ–≤, 3 –∫–∞–Ω–∞–ª–∞ |
| PredictiveAnalyticsService | ‚úÖ | ~560 | 15+ | –ü—Ä–æ–≥–Ω–æ–∑—ã, –ª–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è |
| KPICalculationService | ‚úÖ | ~540 | 15+ | KPI, —Ç–æ–ø –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏, –∑–∞–≥—Ä—É–∑–∫–∞ |
| AlertTriggered Event | ‚úÖ | ~25 | - | –°–æ–±—ã—Ç–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –∞–ª–µ—Ä—Ç–∞ |
| DashboardExportService | ‚è≥ | - | - | PDF/Excel —ç–∫—Å–ø–æ—Ä—Ç |
| DashboardCacheService | üî≤ | - | - | Tagged cache —Å Redis |
| **–ò–¢–û–ì–û** | **80%** | **~2,735** | **80+** | **5 –∏–∑ 6 —Å–µ—Ä–≤–∏—Å–æ–≤** |

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- Redis Cache —Å TTL 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)
- –ö–µ—à –∫–ª—é—á–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏: `cash_flow_`, `roi_`, `user_kpi_`, etc.
- Manual invalidation –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### –ê–ª–≥–æ—Ä–∏—Ç–º—ã
- **–õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è** (y = mx + b) –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
- **–í–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞** –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ KPI
- **–¢—Ä–µ–Ω–¥ –∞–Ω–∞–ª–∏–∑** (–ø–µ—Ä–≤–∞—è vs –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ –ø–µ—Ä–∏–æ–¥–∞)

### –ú–µ—Ç—Ä–∏–∫–∏ –∏ –≤–µ—Å–∞
- KPI weights: 20% works, 25% on-time, 25% quality, 30% efficiency
- Forecast weights: 70% contracts, 30% trend
- –†–∏—Å–∫ thresholds: 5%, 10%, 20% –¥–ª—è budget overrun

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- Required fields –ø—Ä–æ–≤–µ—Ä–∫–∞
- Enum validation –¥–ª—è —Ç–∏–ø–æ–≤ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
- –õ–∏–º–∏—Ç—ã: 10 dashboards per user, 20 alerts per dashboard

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### Models
- ‚úÖ User
- ‚úÖ Contract
- ‚úÖ Project
- ‚úÖ CompletedWork
- ‚úÖ Material
- ‚úÖ Dashboard (Phase 0)
- ‚úÖ DashboardAlert (Phase 0)
- ‚úÖ ScheduledReport (Phase 0)

### Packages
- ‚úÖ Laravel Cache (Redis)
- ‚úÖ Carbon (–¥–∞—Ç—ã)
- ‚è≥ Browsershot –∏–ª–∏ DomPDF (–¥–ª—è PDF export)
- ‚è≥ Maatwebsite/Excel (–¥–ª—è Excel export)

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ TODO –∏ —É–ª—É—á—à–µ–Ω–∏—è

### FinancialAnalyticsService
- [ ] –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –ø—Ä–∏—Ç–æ–∫–∞/–æ—Ç—Ç–æ–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- [ ] –†–∞—Å—á–µ—Ç –¥–µ–±–∏—Ç–æ—Ä—Å–∫–æ–π/–∫—Ä–µ–¥–∏—Ç–æ—Ä—Å–∫–æ–π –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Payment model –¥–ª—è —Ç–æ—á–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤

### DashboardLayoutService
- [ ] –õ–∏–º–∏—Ç—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥—É–ª—è (—Å–µ–π—á–∞—Å —Ö–∞—Ä–¥–∫–æ–¥ 10)
- [ ] –°–≤—è–∑—å User ‚Üí Organization –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

### AlertsService
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (email, in-app, webhook)
- [ ] Payment model –¥–ª—è payment_overdue –∞–ª–µ—Ä—Ç–æ–≤
- [ ] KPI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è kpi_threshold
- [ ] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫

### PredictiveAnalyticsService
- [ ] –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- [ ] Material transactions –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [ ] –£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–µ —Ç–æ–ª—å–∫–æ –ª–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è)

### KPICalculationService
- [ ] Deadline tracking –≤ completed_works
- [ ] –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç
- [ ] –°–≤—è–∑—å User ‚Üí Organization
- [ ] KPI –ø–æ –æ—Ç–¥–µ–ª–∞–º (Department model)

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (Phase 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)

1. **DashboardExportService** (~3 –¥–Ω—è)
   - PDF export —á–µ—Ä–µ–∑ Browsershot
   - Excel export —á–µ—Ä–µ–∑ Maatwebsite/Excel
   - Scheduled reports generation
   - Email –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–æ–≤

2. **DashboardCacheService** (~1 –¥–µ–Ω—å)
   - Tagged cache —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
   - Cache invalidation –º–µ—Ç–æ–¥—ã
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Events

3. **Form Requests –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏** (~1 –¥–µ–Ω—å)
   - CreateDashboardRequest
   - UpdateDashboardRequest
   - CreateAlertRequest
   - UpdateAlertRequest

4. **PostgreSQL –∏–Ω–¥–µ–∫—Å—ã** (~0.5 –¥–Ω—è)
   - Indexes –¥–ª—è contracts (organization_id, project_id, status, progress)
   - Indexes –¥–ª—è completed_works (user_id, project_id, created_at)
   - Indexes –¥–ª—è materials (organization_id, balance)
   - JSONB indexes –¥–ª—è dashboard settings

## –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

- ‚úÖ 0 —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- ‚úÖ 0 linter –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚è≥ Unit —Ç–µ—Å—Ç—ã (0% –ø–æ–∫—Ä—ã—Ç–∏–µ)
- ‚è≥ Integration —Ç–µ—Å—Ç—ã

## –ë–ª–æ–∫–µ—Ä—ã –∏ —Ä–∏—Å–∫–∏

### –ë–ª–æ–∫–µ—Ä—ã
- –ù–µ—Ç: –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ã

### –†–∏—Å–∫–∏
1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - Mitigation: –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏–Ω–¥–µ–∫—Å—ã PostgreSQL
2. **–¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–æ–≤:** –õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ç–æ—á–Ω–æ–π
   - Mitigation: –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –≤ –±—É–¥—É—â–µ–º
3. **Missing data:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –≤ –ë–î
   - Mitigation: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å placeholder –∑–Ω–∞—á–µ–Ω–∏—è, –¥–æ–±–∞–≤–∏—Ç—å TODO

## –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Phase 2

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 1 –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ:
- ‚úÖ –í—Å–µ core —Å–µ—Ä–≤–∏—Å—ã
- ‚è≥ Cache management
- ‚è≥ Export functionality
- üî≤ Controllers –∏ API endpoints (Phase 2)
- üî≤ Real-time updates (Phase 2+)
- üî≤ –¢–µ—Å—Ç—ã

**ETA –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 1:** 2-3 –¥–Ω—è  
**–ü—Ä–æ–≥—Ä–µ—Å—Å Phase 1:** 80% (5 –∏–∑ 6 —Å–µ—Ä–≤–∏—Å–æ–≤)

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 4 –æ–∫—Ç—è–±—Ä—è 2025  
**–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Phase 1:** ~6 —á–∞—Å–æ–≤  
**–°–ª–µ–¥—É—é—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:** DashboardExportService


{
    "uid": "loki-logs-main",
    "title": "ü™µ Laravel Logs (Loki)",
    "tags": [
        "loki",
        "logs",
        "laravel",
        "errors"
    ],
    "timezone": "browser",
    "refresh": "30s",
    "time": {
        "from": "now-3h",
        "to": "now"
    },
    "schemaVersion": 38,
    "version": 1,
    "templating": {
        "list": [
            {
                "name": "job",
                "label": "Job",
                "type": "custom",
                "current": {
                    "value": "laravel",
                    "text": "laravel"
                },
                "options": [
                    {
                        "value": "laravel",
                        "text": "laravel",
                        "selected": true
                    },
                    {
                        "value": "nginx",
                        "text": "nginx"
                    },
                    {
                        "value": "system",
                        "text": "system"
                    }
                ],
                "includeAll": false,
                "multi": false
            },
            {
                "name": "log_type",
                "label": "Log Type",
                "type": "custom",
                "current": {
                    "value": ".*",
                    "text": "All"
                },
                "options": [
                    {
                        "value": ".*",
                        "text": "üåê All",
                        "selected": true
                    },
                    {
                        "value": "errors",
                        "text": "üî¥ Errors only"
                    },
                    {
                        "value": "warnings",
                        "text": "üü° Warnings only"
                    },
                    {
                        "value": "critical",
                        "text": "üö® Critical only"
                    },
                    {
                        "value": "errors|warnings",
                        "text": "üî¥üü° Errors + Warnings"
                    },
                    {
                        "value": "errors|warnings|critical",
                        "text": "üî¥üü°üö® Errors + Warnings + Critical"
                    },
                    {
                        "value": "info",
                        "text": "üîµ Info only"
                    },
                    {
                        "value": "debug",
                        "text": "‚öôÔ∏è Debug only"
                    },
                    {
                        "value": "errors|warnings|critical|info",
                        "text": "üìã All except debug"
                    }
                ],
                "includeAll": false,
                "multi": false
            },
            {
                "name": "env",
                "label": "Environment",
                "type": "custom",
                "current": {
                    "value": ".*",
                    "text": "All"
                },
                "options": [
                    {
                        "value": ".*",
                        "text": "All",
                        "selected": true
                    },
                    {
                        "value": "production",
                        "text": "production"
                    },
                    {
                        "value": "local",
                        "text": "local"
                    },
                    {
                        "value": "staging",
                        "text": "staging"
                    }
                ],
                "includeAll": true,
                "multi": false
            },
            {
                "name": "filename",
                "label": "Log File",
                "type": "custom",
                "current": {
                    "value": ".*",
                    "text": "All"
                },
                "options": [
                    {
                        "value": ".*",
                        "text": "All",
                        "selected": true
                    },
                    {
                        "value": "laravel.log",
                        "text": "laravel.log"
                    },
                    {
                        "value": "worker.log",
                        "text": "worker.log"
                    },
                    {
                        "value": "horizon.log",
                        "text": "horizon.log"
                    }
                ],
                "includeAll": true,
                "multi": false
            },
            {
                "name": "search",
                "label": "üîç Search text",
                "type": "textbox",
                "current": {
                    "value": "",
                    "text": ""
                },
                "query": ""
            }
        ]
    },
    "panels": [
        {
            "id": 1,
            "title": "üî¥ –í—Å–µ ERROR –ª–æ–≥–∏",
            "description": "–í—Å–µ –∑–∞–ø–∏—Å–∏ —É—Ä–æ–≤–Ω—è ERROR –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥. LogQL: {job=\"laravel\", level=\"error\"}",
            "type": "logs",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "{job=\"$job\", level=\"error\", env=~\"$env\", filename=~\"$filename\"}",
                    "legendFormat": "",
                    "refId": "A"
                }
            ],
            "options": {
                "dedupStrategy": "none",
                "showLabels": true,
                "showCommonLabels": false,
                "wrapLogMessage": true,
                "prettifyLogMessage": false,
                "enableLogDetails": true,
                "sortOrder": "Descending"
            },
            "gridPos": {
                "x": 0,
                "y": 0,
                "w": 24,
                "h": 8
            }
        },
        {
            "id": 2,
            "title": "üü° –í—Å–µ WARNING –ª–æ–≥–∏",
            "description": "–í—Å–µ –∑–∞–ø–∏—Å–∏ —É—Ä–æ–≤–Ω—è WARNING. LogQL: {job=\"laravel\", level=\"warning\"}",
            "type": "logs",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "{job=\"$job\", level=\"warning\", env=~\"$env\", filename=~\"$filename\"}",
                    "legendFormat": "",
                    "refId": "A"
                }
            ],
            "options": {
                "dedupStrategy": "none",
                "showLabels": true,
                "showCommonLabels": false,
                "wrapLogMessage": true,
                "prettifyLogMessage": false,
                "enableLogDetails": true,
                "sortOrder": "Descending"
            },
            "gridPos": {
                "x": 0,
                "y": 8,
                "w": 24,
                "h": 8
            }
        },
        {
            "id": 3,
            "title": "üí• Stack Traces / Exceptions",
            "description": "–ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ —Å—Ç–µ–∫—Ç—Ä–µ–π—Å—ã ‚Äî –∏—â–µ–º Exception, Stack trace, #0, #1 –∏ —Ç.–¥.",
            "type": "logs",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "{job=\"$job\", env=~\"$env\", filename=~\"$filename\"} |~ \"(?i)(exception|stack trace|#[0-9]+|Throwable|thrown in)\"",
                    "legendFormat": "",
                    "refId": "A"
                }
            ],
            "options": {
                "dedupStrategy": "none",
                "showLabels": false,
                "showCommonLabels": false,
                "wrapLogMessage": true,
                "prettifyLogMessage": false,
                "enableLogDetails": true,
                "sortOrder": "Descending"
            },
            "gridPos": {
                "x": 0,
                "y": 16,
                "w": 24,
                "h": 10
            }
        },
        {
            "id": 4,
            "title": "üîí Auth / Unauthorized / 401 / 403",
            "description": "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞",
            "type": "logs",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "{job=\"$job\", env=~\"$env\"} |~ \"(?i)(unauthorized|unauthenticated|403|401|forbidden|invalid token|jwt|auth)\"",
                    "legendFormat": "",
                    "refId": "A"
                }
            ],
            "options": {
                "dedupStrategy": "none",
                "showLabels": true,
                "showCommonLabels": false,
                "wrapLogMessage": true,
                "enableLogDetails": true,
                "sortOrder": "Descending"
            },
            "gridPos": {
                "x": 0,
                "y": 26,
                "w": 12,
                "h": 8
            }
        },
        {
            "id": 5,
            "title": "üê¢ –ú–µ–¥–ª–µ–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã",
            "description": "–ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î –∫–æ—Ç–æ—Ä—ã–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è ‚Äî slow query, DB error",
            "type": "logs",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "{job=\"$job\", env=~\"$env\"} |~ \"(?i)(slow query|query time|SQLSTATE|QueryException|Illuminate\\\\Database)\"",
                    "legendFormat": "",
                    "refId": "A"
                }
            ],
            "options": {
                "dedupStrategy": "none",
                "showLabels": true,
                "showCommonLabels": false,
                "wrapLogMessage": true,
                "enableLogDetails": true,
                "sortOrder": "Descending"
            },
            "gridPos": {
                "x": 12,
                "y": 26,
                "w": 12,
                "h": 8
            }
        },
        {
            "id": 6,
            "title": "üìä –ß–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏",
            "description": "–ì—Ä–∞—Ñ–∏–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ ERROR-–ª–æ–≥–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥",
            "type": "timeseries",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "sum(count_over_time({job=\"$job\", level=\"error\", env=~\"$env\"}[5m]))",
                    "legendFormat": "errors/5m",
                    "refId": "A"
                },
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "sum(count_over_time({job=\"$job\", level=\"warning\", env=~\"$env\"}[5m]))",
                    "legendFormat": "warnings/5m",
                    "refId": "B"
                },
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "sum(count_over_time({job=\"$job\", level=\"critical\", env=~\"$env\"}[5m]))",
                    "legendFormat": "critical/5m",
                    "refId": "C"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "custom": {
                        "drawStyle": "bars",
                        "fillOpacity": 40,
                        "lineWidth": 1
                    },
                    "color": {
                        "mode": "palette-classic"
                    }
                },
                "overrides": [
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "errors/5m"
                        },
                        "properties": [
                            {
                                "id": "color",
                                "value": {
                                    "mode": "fixed",
                                    "fixedColor": "red"
                                }
                            }
                        ]
                    },
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "warnings/5m"
                        },
                        "properties": [
                            {
                                "id": "color",
                                "value": {
                                    "mode": "fixed",
                                    "fixedColor": "yellow"
                                }
                            }
                        ]
                    },
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "critical/5m"
                        },
                        "properties": [
                            {
                                "id": "color",
                                "value": {
                                    "mode": "fixed",
                                    "fixedColor": "dark-red"
                                }
                            }
                        ]
                    }
                ]
            },
            "gridPos": {
                "x": 0,
                "y": 34,
                "w": 24,
                "h": 8
            }
        },
        {
            "id": 7,
            "title": "üåê HTTP 500 / Server Errors",
            "description": "–õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ HTTP 500 –æ—à–∏–±–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞",
            "type": "logs",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "{job=\"$job\", env=~\"$env\"} |~ \"(?i)(500|internal server error|server error)\"",
                    "legendFormat": "",
                    "refId": "A"
                }
            ],
            "options": {
                "dedupStrategy": "none",
                "showLabels": false,
                "showCommonLabels": false,
                "wrapLogMessage": true,
                "enableLogDetails": true,
                "sortOrder": "Descending"
            },
            "gridPos": {
                "x": 0,
                "y": 42,
                "w": 12,
                "h": 8
            }
        },
        {
            "id": 8,
            "title": "‚öôÔ∏è Queue / Job Failed",
            "description": "–û—à–∏–±–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π Laravel Horizon/Queue",
            "type": "logs",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "{job=\"$job\", env=~\"$env\"} |~ \"(?i)(job failed|failed.*job|queue.*error|horizon|dispatch|MaxJobAttempts)\"",
                    "legendFormat": "",
                    "refId": "A"
                }
            ],
            "options": {
                "dedupStrategy": "none",
                "showLabels": true,
                "showCommonLabels": false,
                "wrapLogMessage": true,
                "enableLogDetails": true,
                "sortOrder": "Descending"
            },
            "gridPos": {
                "x": 12,
                "y": 42,
                "w": 12,
                "h": 8
            }
        },
        {
            "id": 9,
            "title": "üîç –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É",
            "description": "–°–≤–æ–±–æ–¥–Ω—ã–π –ø–æ–∏—Å–∫. –í–≤–æ–¥–∏ —Ç–µ–∫—Å—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é Search text –≤–≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã",
            "type": "logs",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "{job=\"$job\", env=~\"$env\", filename=~\"$filename\"} |~ \"(?i)$search\"",
                    "legendFormat": "",
                    "refId": "A"
                }
            ],
            "options": {
                "dedupStrategy": "none",
                "showLabels": true,
                "showCommonLabels": false,
                "wrapLogMessage": true,
                "enableLogDetails": true,
                "sortOrder": "Descending"
            },
            "gridPos": {
                "x": 0,
                "y": 50,
                "w": 24,
                "h": 10
            }
        },
        {
            "id": 10,
            "title": "üìã –í—Å–µ –ª–æ–≥–∏ (Live Stream)",
            "description": "–í—Å–µ –ª–æ–≥–∏ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ ‚Äî –¥–ª—è –∂–∏–≤–æ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è",
            "type": "logs",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "{job=\"$job\", log_type=~\"$log_type\", env=~\"$env\", filename=~\"$filename\"}",
                    "legendFormat": "",
                    "refId": "A"
                }
            ],
            "options": {
                "dedupStrategy": "none",
                "showLabels": true,
                "showCommonLabels": false,
                "wrapLogMessage": true,
                "prettifyLogMessage": false,
                "enableLogDetails": true,
                "sortOrder": "Descending"
            },
            "gridPos": {
                "x": 0,
                "y": 60,
                "w": 24,
                "h": 10
            }
        },
        {
            "id": 11,
            "title": "ü§ê CRITICAL –ª–æ–≥–∏",
            "description": "–¢–æ–ª—å–∫–æ CRITICAL —É—Ä–æ–≤–µ–Ω—å ‚Äî —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ",
            "type": "logs",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "{job=\"$job\", level=\"critical\", env=~\"$env\", filename=~\"$filename\"}",
                    "legendFormat": "",
                    "refId": "A"
                }
            ],
            "options": {
                "dedupStrategy": "none",
                "showLabels": true,
                "showCommonLabels": false,
                "wrapLogMessage": true,
                "enableLogDetails": true,
                "sortOrder": "Descending"
            },
            "gridPos": {
                "x": 0,
                "y": 70,
                "w": 24,
                "h": 8
            }
        },
        {
            "id": 12,
            "title": "üì¶ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º",
            "description": "–°–∫–æ–ª—å–∫–æ –ª–æ–≥–æ–≤ –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥",
            "type": "piechart",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "sum by (level) (count_over_time({job=\"$job\", env=~\"$env\"}[$__range]))",
                    "legendFormat": "{{level}}",
                    "refId": "A"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    }
                },
                "overrides": [
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "error"
                        },
                        "properties": [
                            {
                                "id": "color",
                                "value": {
                                    "mode": "fixed",
                                    "fixedColor": "red"
                                }
                            }
                        ]
                    },
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "warning"
                        },
                        "properties": [
                            {
                                "id": "color",
                                "value": {
                                    "mode": "fixed",
                                    "fixedColor": "yellow"
                                }
                            }
                        ]
                    },
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "info"
                        },
                        "properties": [
                            {
                                "id": "color",
                                "value": {
                                    "mode": "fixed",
                                    "fixedColor": "blue"
                                }
                            }
                        ]
                    },
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "critical"
                        },
                        "properties": [
                            {
                                "id": "color",
                                "value": {
                                    "mode": "fixed",
                                    "fixedColor": "dark-red"
                                }
                            }
                        ]
                    }
                ]
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "values": [
                        "value",
                        "percent"
                    ]
                },
                "pieType": "donut"
            },
            "gridPos": {
                "x": 0,
                "y": 78,
                "w": 12,
                "h": 8
            }
        },
        {
            "id": 13,
            "title": "üìÅ –õ–æ–≥–∏ –ø–æ —Ñ–∞–π–ª—É",
            "description": "–¢–æ–ø —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É ERROR-–∑–∞–ø–∏—Å–µ–π",
            "type": "barchart",
            "datasource": {
                "type": "loki",
                "uid": "loki"
            },
            "targets": [
                {
                    "datasource": {
                        "type": "loki",
                        "uid": "loki"
                    },
                    "expr": "sum by (filename) (count_over_time({job=\"$job\", level=\"error\", env=~\"$env\"}[$__range]))",
                    "legendFormat": "{{filename}}",
                    "refId": "A"
                }
            ],
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    }
                }
            },
            "options": {
                "orientation": "horizontal",
                "showValue": "always"
            },
            "gridPos": {
                "x": 12,
                "y": 78,
                "w": 12,
                "h": 8
            }
        }
    ]
}